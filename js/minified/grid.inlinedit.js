(e=>{"function"==typeof define&&define.amd?define(["jquery","./grid.base","./grid.common"],e):e(jQuery)})(function(C){C.jgrid.inlineEdit=C.jgrid.inlineEdit||{},C.jgrid.extend({editRow:function(f,e,i,t,r,a,d,n,o){var p={},s=C.makeArray(arguments).slice(1),g=this[0];return"object"===C.jgrid.type(s[0])?p=s[0]:(void 0!==e&&(p.keys=e),C.jgrid.isFunction(i)&&(p.oneditfunc=i),C.jgrid.isFunction(t)&&(p.successfunc=t),void 0!==r&&(p.url=r),void 0!==a&&(p.extraparam=a),C.jgrid.isFunction(d)&&(p.aftersavefunc=d),C.jgrid.isFunction(n)&&(p.errorfunc=n),C.jgrid.isFunction(o)&&(p.afterrestorefunc=o)),p=C.extend(!0,{keys:!1,keyevent:"keydown",onEnter:null,onEscape:null,oneditfunc:null,successfunc:null,url:null,extraparam:{},aftersavefunc:null,errorfunc:null,afterrestorefunc:null,restoreAfterError:!0,mtype:"POST",focusField:!0,saveui:"enable",savetext:C.jgrid.getRegional(g,"defaults.savetext")},C.jgrid.inlineEdit,p),this.each(function(){var a,d,i,n,e,o=0,s=null,l={},c=C(this).jqGrid("getStyleUI",g.p.styleUI+".inlinedit","inputClass",!0),u=C(this).jqGrid("getStyleUI",g.p.styleUI+".inlinedit","selectClass",!0);g.grid&&!1!==(i=C(g).jqGrid("getInd",f,!0))&&(g.p.beforeAction=!0,(e=void 0===(e=C.jgrid.isFunction(p.beforeEditRow)?p.beforeEditRow.call(g,p,f):void 0)?!0:e)?"0"!==(C(i).attr("editable")||"0")||C(i).hasClass("not-editable-row")||(n=g.p.colModel,C(i).children('td[role="gridcell"]').each(function(i){a=n[i].name;var e,t,r=!0===g.p.treeGrid&&a===g.p.ExpandColumn;if(r)d=C(this).find("span").first().html();else try{d=C.unformat.call(g,this,{rowId:f,colModel:n[i]},i)}catch(e){d=n[i].edittype&&"textarea"===n[i].edittype?C(this).text():C(this).html()}"cb"!==a&&"subgrid"!==a&&"rn"!==a&&"sc"!==a&&(g.p.autoencode&&(d=C.jgrid.htmlDecode(d)),!0===n[i].editable)&&(l[a]=d,null===s&&(s=i),(r?C(this).find("span").first():C(this)).html(""),e=C.extend({},n[i].editoptions||{},{id:f+"_"+a,name:a,rowId:f,oper:"edit",module:"inline"}),n[i].edittype||(n[i].edittype="text"),("&nbsp;"===d||"&#160;"===d||null!==d&&1===d.length&&160===d.charCodeAt(0))&&(d=""),t=C.jgrid.createEl.call(g,n[i].edittype,e,d,!0,C.extend({},C.jgrid.ajaxOptions,g.p.ajaxSelectOptions||{})),C(t).addClass("editable inline-edit-cell"),-1<C.inArray(n[i].edittype,["text","textarea","password"])?C(t).addClass(c):"select"===n[i].edittype&&C(t).addClass(u),(r?C(this).find("span").first():C(this)).append(t),C.jgrid.bindEv.call(g,t,e),"select"===n[i].edittype&&void 0!==n[i].editoptions&&!0===n[i].editoptions.multiple&&void 0===n[i].editoptions.dataUrl&&C.jgrid.msie()&&C(t).width(C(t).width()),o++)}),0<o&&(l.id=f,g.p.savedRow.push(l),C(i).attr("editable","1"),p.focusField&&("number"==typeof p.focusField&&parseInt(p.focusField,10)<=n.length&&(s=p.focusField),setTimeout(function(){var e=C("td",i).eq(s).find(":input:visible").not(":disabled");0<e.length&&e.focus()},0)),!0===p.keys&&C(i).on(p.keyevent,function(e){if(27===e.keyCode){if(C.jgrid.isFunction(p.onEscape))return p.onEscape.call(g,f,p,e),!0;if(C(g).jqGrid("restoreRow",f,p),g.p.inlineNav)try{C(g).jqGrid("showAddEditButtons")}catch(e){}return!1}if(13===e.keyCode){if(e.preventDefault(),C.jgrid.isFunction(p.onEnter))return p.onEnter.call(g,f,p,e),!0;if("TEXTAREA"===e.target.tagName)return!0;if(C(g).jqGrid("saveRow",f,p)&&g.p.inlineNav)try{C(g).jqGrid("showAddEditButtons")}catch(e){}return!1}}),C(g).triggerHandler("jqGridInlineEditRow",[f,p]),C.jgrid.isFunction(p.oneditfunc))&&p.oneditfunc.call(g,f)):g.p.beforeAction=!1)})},saveRow:function(n,e,i,t,r,a,d){var o,s,l,c,u=C.makeArray(arguments).slice(1),f={},p=this[0],g=("object"===C.jgrid.type(u[0])?f=u[0]:(C.jgrid.isFunction(e)&&(f.successfunc=e),void 0!==i&&(f.url=i),void 0!==t&&(f.extraparam=t),C.jgrid.isFunction(r)&&(f.aftersavefunc=r),C.jgrid.isFunction(a)&&(f.errorfunc=a),C.jgrid.isFunction(d)&&(f.afterrestorefunc=d)),f=C.extend(!0,{successfunc:null,url:null,extraparam:{},aftersavefunc:null,errorfunc:null,afterrestorefunc:null,restoreAfterError:!0,mtype:"POST",saveui:"enable",savetext:C.jgrid.getRegional(p,"defaults.savetext")},C.jgrid.inlineEdit,f),!1),j={},v={},w={},m=!1,h=C.jgrid.trim(C(p).jqGrid("getStyleUI",p.p.styleUI+".common","error",!0));if(!p.grid)return g;if(!1===(c=C(p).jqGrid("getInd",n,!0)))return g;var R,y,q,x,b,I=C.jgrid.getRegional(p,"errors"),G=C.jgrid.getRegional(p,"edit"),u=C.jgrid.isFunction(f.beforeSaveRow)?f.beforeSaveRow.call(p,f,n):void 0;if(u=void 0===u?!0:u){if(e=C(c).attr("editable"),f.url=f.url||p.p.editurl,"1"===e){if(C(c).children('td[role="gridcell"]').each(function(e){if(R=p.p.colModel[e],o=R.name,q="","cb"!==o&&"subgrid"!==o&&!0===R.editable&&"rn"!==o&&"sc"!==o&&!C(this).hasClass("not-editable-cell")){switch(R.edittype){case"checkbox":var i=["Yes","No"];R.editoptions&&R.editoptions.value&&(i=R.editoptions.value.split(":")),j[o]=C("input",this).is(":checked")?i[0]:i[1],q=C("input",this);break;case"text":case"password":case"textarea":case"button":j[o]=C("input, textarea",this).val(),q=C("input, textarea",this);break;case"select":var t;R.editoptions.multiple?(i=C("select",this),t=[],j[o]=C(i).val(),j[o]?j[o]=j[o].join(","):j[o]="",C("select option:selected",this).each(function(e,i){t[e]=C(i).text()}),v[o]=t.join(",")):(j[o]=C("select option:selected",this).val(),v[o]=C("select option:selected",this).text()),R.formatter&&(v={}),q=C("select",this);break;case"custom":try{if(!R.editoptions||!C.jgrid.isFunction(R.editoptions.custom_value))throw"e1";if(j[o]=R.editoptions.custom_value.call(p,C(".customelement",this),"get"),void 0===j[o])throw"e2"}catch(e){"e1"===e?C.jgrid.info_dialog(I.errcap,"function 'custom_value' "+G.msg.nodefined,G.bClose,{styleUI:p.p.styleUI}):C.jgrid.info_dialog(I.errcap,e.message,G.bClose,{styleUI:p.p.styleUI})}}if(!1===(l=C.jgrid.checkValues.call(p,j[o],e))[0])return y=e,!1;p.p.autoencode&&(j[o]=C.jgrid.htmlEncode(j[o])),"clientArray"!==f.url&&R.editoptions&&!0===R.editoptions.NullIfEmpty&&""===j[o]&&(w[o]="null",m=!0)}}),!1===l[0]){try{C.jgrid.isFunction(p.p.validationCell)?p.p.validationCell.call(p,q,l[1],c.rowIndex,y):(x=C(p).jqGrid("getGridRowById",n),b=C.jgrid.findPos(x),C.jgrid.info_dialog(I.errcap,l[1],G.bClose,{left:b[0],top:b[1]+C(x).outerHeight(),styleUI:p.p.styleUI,onClose:function(){0<=y&&C("#"+n+"_"+p.p.colModel[y].name).focus()}}))}catch(e){alert(l[1])}return g}var i=p.p.prmNames,_=n,t=!1===p.p.keyName?i.id:p.p.keyName;if(C.isEmptyObject(j)||(j[i.oper]=i.editoper,void 0===j[t]||""===j[t]?j[t]=n:c.id!==p.p.idPrefix+j[t]&&(r=C.jgrid.stripPref(p.p.idPrefix,n),void 0!==p.p._index[r]&&(p.p._index[j[t]]=p.p._index[r],delete p.p._index[r]),n=p.p.idPrefix+j[t],C(c).attr("id",n),p.p.selrow===_&&(p.p.selrow=n),Array.isArray(p.p.selarrrow)&&0<=(a=C.inArray(_,p.p.selarrrow))&&(p.p.selarrrow[a]=n),p.p.multiselect)&&(d="jqg_"+p.p.id+"_"+n,C("input.cbox",c).attr("id",d).attr("name",d)),void 0===p.p.inlineData&&(p.p.inlineData={}),j=C.extend({},j,p.p.inlineData,f.extraparam)),"clientArray"===f.url){j=C.extend({},j,v),p.p.autoencode&&C.each(j,function(e,i){j[e]=C.jgrid.htmlDecode(i)});var A,j=C.jgrid.isFunction(p.p.serializeRowData)?p.p.serializeRowData.call(p,j):j,u=C(p).jqGrid("setRowData",n,j);for(C(c).attr("editable","0"),A=0;A<p.p.savedRow.length;A++)if(String(p.p.savedRow[A].id)===String(_)){s=A;break}C(p).triggerHandler("jqGridInlineAfterSaveRow",[n,u,j,f]),C.jgrid.isFunction(f.aftersavefunc)&&f.aftersavefunc.call(p,n,u,j,f),0<=s&&p.p.savedRow.splice(s,1),g=!0,C(c).removeClass("jqgrid-new-row").off("keydown")}else"storage"===f.url?(j=C.extend({},j,v),p.p.autoencode&&C.each(j,function(e,i){j[e]=C.jgrid.htmlDecode(i)}),j=C.jgrid.isFunction(p.p.serializeRowData)?p.p.serializeRowData.call(p,j):j,C(c).hasClass("jqgrid-new-row")?C(p).jqGrid("addStorageRecord",j).then(function(e){if("complete"===e.type){var i,e=C(p).jqGrid("setRowData",n,j);for(C(c).attr("editable","0"),i=0;i<p.p.savedRow.length;i++)if(String(p.p.savedRow[i].id)===String(_)){s=i;break}C(p).triggerHandler("jqGridInlineAfterSaveRow",[n,e,j,f]),C.jgrid.isFunction(f.aftersavefunc)&&f.aftersavefunc.call(p,n,e,j,f),0<=s&&p.p.savedRow.splice(s,1),g=!0,C(c).removeClass("jqgrid-new-row").off("keydown"),!0===p.p.inlineNav&&C(p).jqGrid("showAddEditButtons")}}).catch(function(e){C.jgrid.info_dialog("Error",e.target.error.name+" : "+e.target.error.message,"Close")}):C(p).jqGrid("updateStorageRecord",j).then(function(e){if("complete"===e.type){var i,e=C(p).jqGrid("setRowData",n,j);for(C(c).attr("editable","0"),i=0;i<p.p.savedRow.length;i++)if(String(p.p.savedRow[i].id)===String(_)){s=i;break}C(p).triggerHandler("jqGridInlineAfterSaveRow",[n,e,j,f]),C.jgrid.isFunction(f.aftersavefunc)&&f.aftersavefunc.call(p,n,e,j,f),0<=s&&p.p.savedRow.splice(s,1),g=!0,C(c).off("keydown"),!0===p.p.inlineNav&&C(p).jqGrid("showAddEditButtons")}}).catch(function(e){C.jgrid.info_dialog("Error",e.target.error.name+" : "+e.target.error.message,"Close")})):(C(p).jqGrid("progressBar",{method:"show",loadtype:f.saveui,htmlcontent:f.savetext}),(w=C.extend({},j,w))[t]=C.jgrid.stripPref(p.p.idPrefix,w[t]),C.ajax(C.extend({url:f.url,data:C.jgrid.isFunction(p.p.serializeRowData)?p.p.serializeRowData.call(p,w):w,type:f.mtype,async:!1,success:function(e,i,t){if(C(p).jqGrid("progressBar",{method:"hide",loadtype:f.saveui,htmlcontent:f.savetext}),"success"===i){var r,a=!0,d=C(p).triggerHandler("jqGridInlineSuccessSaveRow",[t,n,f]);if((d=Array.isArray(d)?d:[!0,w])[0]&&C.jgrid.isFunction(f.successfunc)&&(d=f.successfunc.call(p,t)),Array.isArray(d)?(a=d[0],j=d[1]||j):a=d,!0===a){for(p.p.autoencode&&C.each(j,function(e,i){j[e]=C.jgrid.htmlDecode(i)}),m&&C.each(j,function(e){"null"===j[e]&&(j[e]="")}),j=C.extend({},j,v),C(p).jqGrid("setRowData",n,j),C(c).attr("editable","0"),r=0;r<p.p.savedRow.length;r++)if(String(p.p.savedRow[r].id)===String(n)){s=r;break}C(p).triggerHandler("jqGridInlineAfterSaveRow",[n,t,j,f]),C.jgrid.isFunction(f.aftersavefunc)&&f.aftersavefunc.call(p,n,t,j,f),0<=s&&p.p.savedRow.splice(s,1),g=!0,C(c).removeClass("jqgrid-new-row").off("keydown")}else C(p).triggerHandler("jqGridInlineErrorSaveRow",[n,t,i,null,f]),C.jgrid.isFunction(f.errorfunc)&&f.errorfunc.call(p,n,t,i,null),!0===f.restoreAfterError&&C(p).jqGrid("restoreRow",n,f)}},error:function(e,i,t){if(C("#lui_"+C.jgrid.jqID(p.p.id)).hide(),C(p).triggerHandler("jqGridInlineErrorSaveRow",[n,e,i,t,f]),C.jgrid.isFunction(f.errorfunc))f.errorfunc.call(p,n,e,i,t);else{i=e.responseText||e.statusText;try{C.jgrid.info_dialog(I.errcap,'<div class="'+h+'">'+i+"</div>",G.bClose,{buttonalign:"right",styleUI:p.p.styleUI})}catch(e){alert(i)}}!0===f.restoreAfterError&&C(p).jqGrid("restoreRow",n,f)}},C.jgrid.ajaxOptions,p.p.ajaxRowOptions||{})))}return g}},restoreRow:function(n,e){var i=C.makeArray(arguments).slice(1),o={};return"object"===C.jgrid.type(i[0])?o=i[0]:C.jgrid.isFunction(e)&&(o.afterrestorefunc=e),o=C.extend(!0,{},C.jgrid.inlineEdit,o),this.each(function(){var e,i,t=this,r=-1,a={};if(t.grid&&!1!==(e=C(t).jqGrid("getInd",n,!0))){var d=C.jgrid.isFunction(o.beforeCancelRow)?o.beforeCancelRow.call(t,o,n):void 0;if(d=void 0===d?!0:d){for(i=0;i<t.p.savedRow.length;i++)if(String(t.p.savedRow[i].id)===String(n)){r=i;break}if(0<=r){if(C.jgrid.isFunction(C.fn.datepicker))try{C("input.hasDatepicker","#"+C.jgrid.jqID(e.id)).datepicker("hide")}catch(e){}C.each(t.p.colModel,function(){t.p.savedRow[r].hasOwnProperty(this.name)&&(a[this.name]=t.p.savedRow[r][this.name])}),C(t).jqGrid("setRowData",n,a),C(e).attr("editable","0").off("keydown"),t.p.savedRow.splice(r,1),C("#"+C.jgrid.jqID(n),"#"+C.jgrid.jqID(t.p.id)).hasClass("jqgrid-new-row")&&setTimeout(function(){C(t).jqGrid("delRowData",n),C(t).jqGrid("showAddEditButtons")},0)}C(t).triggerHandler("jqGridInlineAfterRestoreRow",[n]),C.jgrid.isFunction(o.afterrestorefunc)&&o.afterrestorefunc.call(t,n)}}})},addRow:function(r){return r=C.extend(!0,{rowID:null,initdata:{},position:"first",useDefValues:!0,useFormatter:!1,addRowParams:{extraparam:{}}},r||{}),this.each(function(){var i,e,t;this.grid&&((i=this).p.beforeAction=!0,(e=void 0===(e=C.jgrid.isFunction(r.beforeAddRow)?r.beforeAddRow.call(i,r.addRowParams):void 0)?!0:e)?(r.rowID=C.jgrid.isFunction(r.rowID)?r.rowID.call(i,r):null!=r.rowID?r.rowID:C.jgrid.randId(),!0===r.useDefValues&&C(i.p.colModel).each(function(){var e;this.editoptions&&this.editoptions.defaultValue&&(e=this.editoptions.defaultValue,e=C.jgrid.isFunction(e)?e.call(i):e,r.initdata[this.name]=e)}),C(i).jqGrid("addRowData",r.rowID,r.initdata,r.position),r.rowID=i.p.idPrefix+r.rowID,C("#"+C.jgrid.jqID(r.rowID),"#"+C.jgrid.jqID(i.p.id)).addClass("jqgrid-new-row"),r.useFormatter?C("#"+C.jgrid.jqID(r.rowID)+" .ui-inline-edit","#"+C.jgrid.jqID(i.p.id)).click():(t=(e=i.p.prmNames).oper,r.addRowParams.extraparam[t]=e.addoper,C(i).jqGrid("editRow",r.rowID,r.addRowParams),C(i).jqGrid("setSelection",r.rowID))):i.p.beforeAction=!1)})},inlineNav:function(d,n){var o=this[0],s=C.jgrid.getRegional(o,"nav"),e=C.jgrid.styleUI[o.p.styleUI].inlinedit;return n=C.extend(!0,{edit:!0,editicon:e.icon_edit_nav,add:!0,addicon:e.icon_add_nav,save:!0,saveicon:e.icon_save_nav,cancel:!0,cancelicon:e.icon_cancel_nav,addParams:{addRowParams:{extraparam:{}}},editParams:{},restoreAfterSelect:!0,saveAfterSelect:!1},s,n||{}),this.each(function(){if(this.grid&&!this.p.inlineNav){var a=C.jgrid.jqID(o.p.id),i=C.jgrid.trim(C(o).jqGrid("getStyleUI",o.p.styleUI+".common","disabled",!0));if(o.p.navGrid||C(o).jqGrid("navGrid",d,{refresh:!1,edit:!1,add:!1,del:!1,search:!1,view:!1}),C(o).data("inlineNav")||C(o).data("inlineNav",n),o.p.force_regional&&(n=C.extend(n,s)),(o.p.inlineNav=!0)===n.addParams.useFormatter)for(var e,t=o.p.colModel,r=0;r<t.length;r++)if(t[r].formatter&&"actions"===t[r].formatter){t[r].formatoptions&&(e=C.extend({keys:!1,onEdit:null,onSuccess:null,afterSave:null,onError:null,afterRestore:null,extraparam:{},url:null},t[r].formatoptions),n.addParams.addRowParams={keys:e.keys,oneditfunc:e.onEdit,successfunc:e.onSuccess,url:e.url,extraparam:e.extraparam,aftersavefunc:e.afterSave,errorfunc:e.onError,afterrestorefunc:e.afterRestore});break}n.add&&C(o).jqGrid("navButtonAdd",d,{caption:n.addtext,title:n.addtitle,buttonicon:n.addicon,id:o.p.id+"_iladd",internal:!0,onClickButton:function(){void 0===o.p.beforeAction&&(o.p.beforeAction=!0),C(o).jqGrid("addRow",n.addParams),!n.addParams.useFormatter&&o.p.beforeAction&&(C("#"+a+"_ilsave").removeClass(i),C("#"+a+"_ilcancel").removeClass(i),C("#"+a+"_iladd").addClass(i),C("#"+a+"_iledit").addClass(i))}}),n.edit&&C(o).jqGrid("navButtonAdd",d,{caption:n.edittext,title:n.edittitle,buttonicon:n.editicon,id:o.p.id+"_iledit",internal:!0,onClickButton:function(){var e=C(o).jqGrid("getGridParam","selrow");e?(void 0===o.p.beforeAction&&(o.p.beforeAction=!0),C(o).jqGrid("editRow",e,n.editParams),o.p.beforeAction&&(C("#"+a+"_ilsave").removeClass(i),C("#"+a+"_ilcancel").removeClass(i),C("#"+a+"_iladd").addClass(i),C("#"+a+"_iledit").addClass(i))):(C.jgrid.viewModal("#alertmod_"+a,{gbox:"#gbox_"+a,jqm:!0}),C("#jqg_alrt").focus())}}),n.save&&(C(o).jqGrid("navButtonAdd",d,{caption:n.savetext||"",title:n.savetitle||"Save row",buttonicon:n.saveicon,id:o.p.id+"_ilsave",internal:!0,onClickButton:function(){var e,i,t,r=o.p.savedRow[0].id;r?(i=(e=o.p.prmNames).oper,t=n.editParams,C("#"+C.jgrid.jqID(r),"#"+a).hasClass("jqgrid-new-row")?(n.addParams.addRowParams.extraparam[i]=e.addoper,t=n.addParams.addRowParams):(n.editParams.extraparam||(n.editParams.extraparam={}),n.editParams.extraparam[i]=e.editoper),C(o).jqGrid("saveRow",r,t)&&C(o).jqGrid("showAddEditButtons")):(C.jgrid.viewModal("#alertmod_"+a,{gbox:"#gbox_"+a,jqm:!0}),C("#jqg_alrt").focus())}}),C("#"+a+"_ilsave").addClass(i)),n.cancel&&(C(o).jqGrid("navButtonAdd",d,{caption:n.canceltext||"",title:n.canceltitle||"Cancel row editing",buttonicon:n.cancelicon,id:o.p.id+"_ilcancel",internal:!0,onClickButton:function(){var e=o.p.savedRow[0].id,i=n.editParams;e?(C("#"+C.jgrid.jqID(e),"#"+a).hasClass("jqgrid-new-row")&&(i=n.addParams.addRowParams),C(o).jqGrid("restoreRow",e,i),C(o).jqGrid("showAddEditButtons")):(C.jgrid.viewModal("#alertmod",{gbox:"#gbox_"+a,jqm:!0}),C("#jqg_alrt").focus())}}),C("#"+a+"_ilcancel").addClass(i)),!0!==n.restoreAfterSelect&&!0!==n.saveAfterSelect||C(o).on("jqGridBeforeSelectRow.inlineNav",function(e,i){0<o.p.savedRow.length&&!0===o.p.inlineNav&&i!==o.p.selrow&&null!==o.p.selrow&&(i=!0,o.p.selrow===n.addParams.rowID?C(o).jqGrid("delRowData",o.p.selrow):!0===n.restoreAfterSelect?C(o).jqGrid("restoreRow",o.p.selrow,n.editParams):i=C(o).jqGrid("saveRow",o.p.selrow,n.editParams),i)&&C(o).jqGrid("showAddEditButtons")})}})},showAddEditButtons:function(){return this.each(function(){var e,i;this.grid&&(e=C.jgrid.jqID(this.p.id),i=C.jgrid.trim(C(this).jqGrid("getStyleUI",this.p.styleUI+".common","disabled",!0)),C("#"+e+"_ilsave").addClass(i),C("#"+e+"_ilcancel").addClass(i),C("#"+e+"_iladd").removeClass(i),C("#"+e+"_iledit").removeClass(i))})},showSaveCancelButtons:function(){return this.each(function(){var e,i;this.grid&&(e=C.jgrid.jqID(this.p.id),i=C.jgrid.trim(C(this).jqGrid("getStyleUI",this.p.styleUI+".common","disabled",!0)),C("#"+e+"_ilsave").removeClass(i),C("#"+e+"_ilcancel").removeClass(i),C("#"+e+"_iladd").addClass(i),C("#"+e+"_iledit").addClass(i))})}})});