!function(e){"function"==typeof define&&define.amd?define(["jquery","./grid.base","jquery-ui/dialog","jquery-ui/draggable","jquery-ui/droppable","jquery-ui/resizable","jquery-ui/sortable","./addons/ui.multiselect"],e):e(jQuery)}(function(b){var a;b.jgrid.msie()&&8===b.jgrid.msiever()&&(b.expr[":"].hidden=function(e){return 0===e.offsetWidth||0===e.offsetHeight||"none"===e.style.display}),b.jgrid._multiselect=!1,b.ui&&b.ui.multiselect&&(b.ui.multiselect.prototype._setSelected&&(a=b.ui.multiselect.prototype._setSelected,b.ui.multiselect.prototype._setSelected=function(e,t){var i,e=a.call(this,e,t);return t&&this.selectedList&&(i=this.element,this.selectedList.find("li").each(function(){b(this).data("optionLink")&&b(this).data("optionLink").remove().appendTo(i)})),e}),b.ui.multiselect.prototype.destroy&&(b.ui.multiselect.prototype.destroy=function(){this.element.show(),this.container.remove(),(void 0===b.Widget?b.widget:b.Widget).prototype.destroy.apply(this,arguments)}),b.jgrid._multiselect=!0),b.jgrid.extend({sortableColumns:function(d){return this.each(function(){var r=this,e=b.jgrid.jqID(r.p.id),t=!1;function i(){r.p.disableClick=!0,r.p.frozenColumns&&(b(r).jqGrid("destroyFrozenColumns"),t=!0)}function a(){setTimeout(function(){r.p.disableClick=!1,t&&(b(r).jqGrid("setFrozenColumns"),t=!1)},50)}var o,s,e={tolerance:"pointer",axis:"x",scrollSensitivity:"1",items:">th:not(:has(#jqgh_"+e+"_cb,#jqgh_"+e+"_rn,#jqgh_"+e+"_subgrid),:hidden)",cancel:".sortable-disabled",placeholder:{element:function(e){return b(document.createElement(e[0].nodeName)).addClass(e[0].className+" ui-sortable-placeholder ui-state-highlight").removeClass("ui-sortable-helper")[0]},update:function(e,t){t.height(e.currentItem.innerHeight()-parseInt(e.currentItem.css("paddingTop")||0,10)-parseInt(e.currentItem.css("paddingBottom")||0,10)),t.width(e.currentItem.innerWidth()-parseInt(e.currentItem.css("paddingLeft")||0,10)-parseInt(e.currentItem.css("paddingRight")||0,10))}},update:function(e,t){var t=b(t.item).parent(),t=b(">th",t),i=r.p.colModel,a={},o=r.p.id+"_",s=(b.each(i,function(e){a[this.name]=e}),[]);t.each(function(){var e=b(">div",this).get(0).id.replace(/^jqgh_/,"").replace(o,"");a.hasOwnProperty(e)&&s.push(a[e])}),b(r).jqGrid("remapColumns",s,!0,!0),b.jgrid.isFunction(r.p.sortable.update)&&r.p.sortable.update(s)}},e=(r.p.sortable.options?b.extend(e,r.p.sortable.options):b.jgrid.isFunction(r.p.sortable)&&(r.p.sortable={update:r.p.sortable}),e.start?(o=e.start,e.start=function(e,t){i(),o.call(this,e,t)}):e.start=i,e.stop?(s=e.stop,e.stop=function(e,t){a(),s.call(this,e,t)}):e.stop=a,r.p.sortable.exclude&&(e.items+=":not("+r.p.sortable.exclude+")"),d.sortable(e)),e=e.data("sortable")||e.data("uiSortable");null!=e&&(e.data("sortable").floating=!0)})},columnChooser:function(t){var i,a,o=this,r={},s=[],e=o.jqGrid("getGridParam","colModel"),d=b.extend([],o.jqGrid("getGridParam","colNames")),n=function(e){return b.ui.multiselect.prototype&&e.data(b.ui.multiselect.prototype.widgetFullName||b.ui.multiselect.prototype.widgetName)||e.data("ui-multiselect")||e.data("multiselect")},l=b.jgrid.getRegional(this[0],"col");if(!b("#colchooser_"+b.jgrid.jqID(o[0].p.id)).length){if(i=b('<div id="colchooser_'+o[0].p.id+'" style="position:relative;overflow:hidden"><div><select multiple="multiple"></select></div></div>'),a=b("select",i),t=b.extend({width:400,height:240,classname:null,groupHeaders:!1,done:function(e){e&&o.jqGrid("remapColumns",e,!0)},msel:"multiselect",dlog:"dialog",dialog_opts:{minWidth:470,dialogClass:"ui-jqdialog"},dlog_opts:function(e){var t={};return t[e.bSubmit]=function(){e.apply_perm(),e.cleanup(!1)},t[e.bCancel]=function(){e.cleanup(!0)},b.extend(!0,{buttons:t,close:function(){e.cleanup(!0)},modal:e.modal||!1,resizable:e.resizable||!0,width:e.width+70,resize:f},e.dialog_opts||{})},apply_perm:function(){var s=[];b("option",a).each(function(){b(this).is(":selected")?o.jqGrid("showCol",e[this.value].name):o.jqGrid("hideCol",e[this.value].name)}),b("option[selected]",a).each(function(){this.selected&&s.push(parseInt(this.value,10))}),b.each(s,function(){delete r[e[parseInt(this,10)].name]}),b.each(r,function(){var e,t,i,a,o=parseInt(this,10);e=s,t=o=o,s=0<=o?(a=(i=e.slice()).splice(o,Math.max(e.length-o,o)),i[o=o>e.length?e.length:o]=t,i.concat(a)):e}),t.done&&t.done.call(o,s),o.jqGrid("setGridWidth",o[0].p.width,o[0].p.shrinkToFit)},cleanup:function(e){m(t.dlog,i,"destroy"),m(t.msel,a,"destroy"),i.remove(),e&&t.done&&t.done.call(o)},msel_opts:{dividerLocation:.5}},l,t||{}),b.ui&&b.ui.multiselect&&b.ui.multiselect.defaults){if(!b.jgrid._multiselect)return void alert("Multiselect plugin loaded after jqGrid. Please load the plugin before the jqGrid!");t.msel_opts=b.extend(b.ui.multiselect.defaults,t.msel_opts)}if(o.jqGrid("isGroupHeaderOn")&&t.groupHeaders)for(var l=o[0].p.groupHeader.length,c=o[0].p.groupHeader[l-1],u=0;u<d.length;u++){var p=b.jgrid.inColumnHeader(e[u].name,c.groupHeaders);if(0<=p){d[u]=c.groupHeaders[p].titleText+"::"+d[u];for(var h=1;h<=c.groupHeaders[p].numberOfColumns-1;h++)d[u+h]=c.groupHeaders[p].titleText+"::"+d[u+h];u=u+c.groupHeaders[p].numberOfColumns-1}}t.caption&&i.attr("title",t.caption),t.classname&&(i.addClass(t.classname),a.addClass(t.classname)),t.width&&(b(">div",i).css({width:t.width,margin:"0 auto"}),a.css("width",t.width)),t.height&&(b(">div",i).css("height",t.height),a.css("height",t.height-10)),a.empty(),b.each(e,function(e){r[this.name]=e,this.hidedlg?this.hidden||s.push(e):a.append("<option value='"+e+"' "+(this.hidden?"":"selected='selected'")+">"+b.jgrid.stripHtml(d[e])+"</option>")}),l=b.jgrid.isFunction(t.dlog_opts)?t.dlog_opts.call(o,t):t.dlog_opts,m(t.dlog,i,l),l=b.jgrid.isFunction(t.msel_opts)?t.msel_opts.call(o,t):t.msel_opts,m(t.msel,a,l);var l=b("#colchooser_"+b.jgrid.jqID(o[0].p.id)),g=b(".ui-jqgrid").css("font-size")||"11px";l.parent().css("font-size",g),l.css({margin:"auto"}),l.find(">div").css({width:"100%",height:"100%",margin:"auto"}),(g=n(a)).container.css({width:"100%",height:"100%",margin:"auto"}),g.selectedContainer.css({width:100*g.options.dividerLocation+"%",height:"100%",margin:"auto",boxSizing:"border-box"}),g.availableContainer.css({width:100-100*g.options.dividerLocation+"%",height:"100%",margin:"auto",boxSizing:"border-box"}),g.selectedList.css("height","auto"),g.availableList.css("height","auto"),l=Math.max(g.selectedList.height(),g.availableList.height()),l=Math.min(l,b(window).height()),g.selectedList.css("height",l),g.availableList.css("height",l),f()}function m(e,t){e&&("string"==typeof e?b.fn[e]&&b.fn[e].apply(t,b.makeArray(arguments).slice(2)):b.jgrid.isFunction(e)&&e.apply(t,b.makeArray(arguments).slice(2)))}function f(){var e=n(a),t=e.container.closest(".ui-dialog-content");0<t.length&&"object"==typeof t[0].style?t[0].style.width="":t.css("width",""),e.selectedList.height(Math.max(e.selectedContainer.height()-e.selectedActions.outerHeight()-1,1)),e.availableList.height(Math.max(e.availableContainer.height()-e.availableActions.outerHeight()-1,1))}},sortableRows:function(o){return this.each(function(){var a=this;a.grid&&!a.p.treeGrid&&b.fn.sortable&&((o=b.extend({cursor:"move",axis:"y",items:" > .jqgrow"},o||{})).start&&b.jgrid.isFunction(o.start)?(o._start_=o.start,delete o.start):o._start_=!1,o.update&&b.jgrid.isFunction(o.update)?(o._update_=o.update,delete o.update):o._update_=!1,o.start=function(e,t){if(b(t.item).css("border-width","0"),b("td",t.item).each(function(e){this.style.width=a.grid.cols[e].style.width}),a.p.subGrid){var i=b(t.item).attr("id");try{b(a).jqGrid("collapseSubGridRow",i)}catch(e){}}o._start_&&o._start_.apply(this,[e,t])},o.update=function(e,t){b(t.item).css("border-width",""),!0===a.p.rownumbers&&b("td.jqgrid-rownum",a.rows).each(function(e){b(this).html(e+1+(parseInt(a.p.page,10)-1)*parseInt(a.p.rowNum,10))}),o._update_&&o._update_.apply(this,[e,t])},b(a).find("tbody").first().sortable(o),b("tbody",a).first().find(" > .jqgrow").disableSelection())})},gridDnD:function(a){return this.each(function(){var e,t,s=this;if(s.grid&&!s.p.treeGrid&&b.fn.draggable&&b.fn.droppable){var h;if(void 0===b("#jqgrid_dnd")[0]&&b("body").append("<table id='jqgrid_dnd' class='ui-jqgrid-dnd'></table>"),"string"==typeof a&&"updateDnD"===a&&!0===s.p.jqgdnd)i();else if((a=b.extend({drag:function(o){return b.extend({start:function(e,t){var i,a;if(s.p.subGrid){a=b(t.helper).attr("id");try{b(s).jqGrid("collapseSubGridRow",a)}catch(e){}}for(i=0;i<b.data(s,"dnd").connectWith.length;i++)0===b(b.data(s,"dnd").connectWith[i]).jqGrid("getGridParam","reccount")&&b(b.data(s,"dnd").connectWith[i]).jqGrid("addRowData","jqg_empty_row",{});t.helper.addClass("ui-state-highlight"),b("td",t.helper).each(function(e){this.style.width=s.grid.headers[e].width+"px"}),o.onstart&&b.jgrid.isFunction(o.onstart)&&o.onstart.call(b(s),e,t)},stop:function(e,t){var i,a;for(t.helper.dropped&&!o.dragcopy&&(void 0===(a=b(t.helper).attr("id"))&&(a=b(this).attr("id")),b(s).jqGrid("delRowData",a)),i=0;i<b.data(s,"dnd").connectWith.length;i++)b(b.data(s,"dnd").connectWith[i]).jqGrid("delRowData","jqg_empty_row");o.onstop&&b.jgrid.isFunction(o.onstop)&&o.onstop.call(b(s),e,t)}},o.drag_opts||{})},drop:function(p){return b.extend({accept:function(e){if(!b(e).hasClass("jqgrow"))return e;h=b(e).closest("table.ui-jqgrid-btable");var t,e=b(this).find("table.ui-jqgrid-btable").first()[0];return 0<h.length&&void 0!==b.data(h[0],"dnd")&&(t=b.data(h[0],"dnd").connectWith,-1!==b.inArray("#"+b.jgrid.jqID(e.id),t))},drop:function(e,t){if(b(t.draggable).hasClass("jqgrow")){var i,a,o=b(t.draggable).attr("id"),s=t.draggable.parent().parent().jqGrid("getRowData",o),r=[],o=b(this).find("table.ui-jqgrid-btable").first()[0];if(b.isPlainObject(s)&&(r=Object.keys(s)),!p.dropbyname){var d,n,l={},c=0,u=b("#"+b.jgrid.jqID(o.id)).jqGrid("getGridParam","colModel");try{for(d=0;d<u.length;d++)"cb"!==(n=u[d].name)&&"rn"!==n&&"subgrid"!==n&&"sc"!==n&&(void 0!==r[c]&&(l[n]=s[r[c]]),c++);s=l}catch(e){}}t.helper.dropped=!0,b.data(h[0],"dnd").beforedrop&&b.jgrid.isFunction(b.data(h[0],"dnd").beforedrop)&&null!=(i=b.data(h[0],"dnd").beforedrop.call(o,e,t,s,b(h[0]),b(o)))&&"object"==typeof i&&(s=i),t.helper.dropped&&(p.autoid&&(a=b.jgrid.isFunction(p.autoid)?p.autoid.call(o,s):(a=Math.ceil(1e3*Math.random()),p.autoidprefix+a)),b("#"+b.jgrid.jqID(o.id)).jqGrid("addRowData",a,s,p.droppos)),p.ondrop&&b.jgrid.isFunction(p.ondrop)&&p.ondrop.call(o,e,t,s)}}},p.drop_opts||{})},onstart:null,onstop:null,beforedrop:null,ondrop:null,drop_opts:{activeClass:"ui-state-active",hoverClass:"ui-state-hover",tolerance:"intersect"},drag_opts:{revert:"invalid",helper:"clone",cursor:"move",appendTo:"#jqgrid_dnd",zIndex:5e3},dragcopy:!1,dropbyname:!1,droppos:"first",autoid:!0,autoidprefix:"dnd_"},a||{})).connectWith)for(a.connectWith=a.connectWith.split(","),a.connectWith=b.map(a.connectWith,function(e){return b.jgrid.trim(e)}),b.data(s,"dnd",a),0===s.p.reccount||s.p.jqgdnd||i(),s.p.jqgdnd=!0,e=0;e<a.connectWith.length;e++)t=a.connectWith[e],b(t).closest(".ui-jqgrid-bdiv").droppable(b.jgrid.isFunction(a.drop)?a.drop.call(b(s),a):a.drop)}function i(){var e=b.data(s,"dnd");b("tr.jqgrow:not(.ui-draggable)",s).draggable(b.jgrid.isFunction(e.drag)?e.drag.call(b(s),e):e.drag)}})},gridResize:function(s){return this.each(function(){var i,e,t,a=this,o=b.jgrid.jqID(a.p.id);a.grid&&b.fn.resizable&&((s=b.extend({},{resizeclass:"ui-resizable-icon"},s||{})).alsoResize?(s._alsoResize_=s.alsoResize,delete s.alsoResize):s._alsoResize_=!1,s.stop&&b.jgrid.isFunction(s.stop)?(s._stop_=s.stop,delete s.stop):s._stop_=!1,e=s.resizeclass,"jQueryUI"!==a.p.styleUI&&(s.handles?s.handles.se?e+=" "+s.handles.se.replace(".",""):s.handles.se="."+e:(s.handles={},t=e.split(" "),s.handles.se="."+t[0]),e+=" ui-resizable-se ui-resizable-handle",b("#gbox_"+o).append('<span class="'+e+'"></span>')),s.stop=function(e,t){b(a).jqGrid("setGridParam",{height:b("#gview_"+o+" .ui-jqgrid-bdiv").height()}),b(a).jqGrid("setGridWidth",t.size.width,s.shrinkToFit),s._stop_&&s._stop_.call(a,e,t),a.p.caption&&b("#gbox_"+o).css({height:"auto"}),a.p.frozenColumns&&(i&&clearTimeout(i),i=setTimeout(function(){i&&clearTimeout(i),b("#"+o).jqGrid("destroyFrozenColumns"),b("#"+o).jqGrid("setFrozenColumns")}))},s._alsoResize_?s.alsoResize="#gview_"+o+" .ui-jqgrid-bdiv,"+s._alsoResize_:s.alsoResize=b(".ui-jqgrid-bdiv","#gview_"+o),delete s._alsoResize_,b("#gbox_"+o).resizable(s))})}})});