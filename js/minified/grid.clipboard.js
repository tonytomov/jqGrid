(e=>{"function"==typeof define&&define.amd?define(["jquery","./grid.base"],e):e(jQuery)})(function(_){_.extend(_.jgrid,{deserializeRow:function(e,t=","){var i=[];let o=0,r=0,s=!1;for(;;){if(o===e.length){i.push(e.slice(r,o));break}var a=e[o];a!==t||s||(i.push(e.slice(r,o).replace(/^"|"$/g,"").replace(/""/g,'"').replace(/\\n/g,"\n")),r=o+1),'"'===a&&('"'===e[o+1]?o+=1:s=!s),o+=1}return i},CSVtoObject:function(e,t,i=",",o){var r=e.length;return r&&""==e[r-1]&&e.pop(),e.map(e=>{let o=_.jgrid.deserializeRow(e,i);return t.reduce((e,t,i)=>(e[t]=o[i],e),{})})},Permissions:async function(){navigator.permissions.query({name:"clipboard-read",allowWithoutGesture:!1}).then(e=>{e&&"denied"===e.state&&(e=_.jgrid.getRegional(this,"clipboard.errors"),_.jgrid.toast({text:e.enb_prm,autoClose:!1,styleUI:this.p.styleUI,type:"warning"}))}).catch(e=>{console.log("clipboard-read permission not supported for this browser.")})},copyText:async function(t,e){try{var i;await navigator.clipboard.writeText(t),e.show_info_after_copy&&(i=_.jgrid.getRegional(this,"clipboard.msg"),_.jgrid.toast({text:i.text_c,styleUI:this.p.styleUI,type:"info",position:e.toastPosition}))}catch(e){t=_.jgrid.getRegional(this,"clipboard.errors");_.jgrid.toast({text:t.copy_err+e,autoCloseTime:4500,styleUI:this.p.styleUI,type:"error"})}},getClipboardContents:async function(){try{return await navigator.clipboard.readText()}catch(e){var t=_.jgrid.getRegional(this,"clipboard.errors");_.jgrid.toast({text:t.read_err+e,styleUI:this.p.styleUI,autoCloseTime:4500,type:"error"})}},copyRows:function(e,t,i){for(var o=[],r=[],s=!1,a=_(e).parents("table")[0],l=0;l<e.length;l++){var n=e[l],d=[];if(n.classList.contains("jqgrow")){for(var c=0;c<n.cells.length;c++)if(n.cells[c].classList.contains("selected-cell"))if(!1===s&&r.push(t[c].name),!0===i.copy_formated_data)d.push(n.cells[c].innerText);else try{d.push(_.unformat.call(a,_(n.cells[c]),{rowId:n.id,colModel:t[c]},c))}catch(e){d.push(_.jgrid.htmlDecode(n.cells[c].innerHTML))}r.length&&(s=!0),d.length&&o.push(d.join(i.copy_delimiter))}}i.copy_header_included&&r.length&&o.unshift(r.join(i.copy_delimiter)),_.jgrid.isFunction(i.beforeCopyData)&&i.beforeCopyData.call(this,o,i),_.jgrid.copyText.call(a,o.join(i.copy_newline),i),i.startCellIndex=null,i.startRowIndex=null,_.jgrid.isFunction(i.afterCopyData)&&i.afterCopyData.call(this,o,i)},pasteRows:function(s,a){var e,l,n;null===s.startCellIndex||null===s.startRowIndex?(e=_.jgrid.getRegional(this,"clipboard.msg"),_.jgrid.toast({text:e.select_pos,position:"middle center",autoClose:!1,styleUI:this.p.styleUI,type:"warning"})):(l=this.p.colModel,n=this.p.id,_.jgrid.getClipboardContents.call(this).then(e=>{if(""===e||null==e)t=_.jgrid.getRegional(this,"clipboard.errors"),_.jgrid.toast({text:t.get_data_err,styleUI:this.p.styleUI,autoCloseTime:4500,type:"error"});else{var t=s.paste_autodetect_delim?_.jgrid.guessDelimiters(e):s.paste_delimiter,i=[];if(_.jgrid.isFunction(s.beforePasteData)&&s.beforePasteData.call(this,e,t),e=e.split(s.paste_newline),s.paste_header_included){var o=e[0].split(t).length;(o+=s.startCellIndex)>l.length&&(o=l.length);for(var r=s.startCellIndex;r<o;r++)i.push(l[r].name)}else i=_.jgrid.deserializeRow(e.shift(),t);_.jgrid.isLocalStorage()&&localStorage.removeItem(n+"_restore");t=_.jgrid.CSVtoObject(e,i,t,s.paste_newline);_("#"+n).jqGrid("updateRowsByIndex",s.startRowIndex,t,s,a),_.jgrid.isFunction(s.afterPasteData)&&s.afterPasteData.call(this,e)}}))},undoPaste:function(t){if(_.jgrid.isLocalStorage()){var i=localStorage.getItem(t+"_restore");if(i&&(i=JSON.parse(i),Array.isArray(i)))for(let e=0;e<i.length;e++)_("#"+t).jqGrid("setRowData",i[e]._id_,i[e]);var o=_("#"+t);o.find("tr.frompaste").each(function(e,t){o.jqGrid("delRowData",t.id)})}},guessDelimiters:function(t,e=["\t",",",";","|"]){e=e.map(e=>t.indexOf(e)).reduce((e,t)=>-1===e||-1!==t&&t<e?t:e);return t[e]||"\t"},repeatRow:function(e){for(var t=[],i=!1,o=this.rows,r=this.p.colModel,s=[],a={},l=[],n=_.jgrid.getRegional(this,"clipboard.errors"),d=0;d<o.length;d++){var c,p=null,u=o[d];if(u.classList.contains("jqgrow")){for(var g=0;g<u.cells.length;g++)if(u.cells[g].classList.contains("selected-cell"))if(!1===i){t.push(r[g].name),u.id;try{a[r[g].name]=_.unformat.call(this,_(u.cells[g]),{rowId:u.id,colModel:r[g]},g)}catch(e){a[r[g].name]=_.jgrid.htmlDecode(u.cells[g].innerHTML)}}else p=u.id;t.length&&(i=!0)}null!==p&&((c=_(this).jqGrid("getRowData",p))._id_=p,l.push(c),s.push(p))}_.jgrid.isLocalStorage()?(localStorage.removeItem(this.id+"_restore"),localStorage.setItem(this.id+"_restore",JSON.stringify(l))):_.jgrid.toast({text:n.local_stor_err,autoCloseTime:4500,styleUI:this.p.styleUI,type:"warning"});for(let e=0;e<s.length;e++)_(this).jqGrid("setRowData",s[e],a);e.startCellIndex=null,e.startRowIndex=null},repeatCol:function(e){for(var i,o=[],t=!1,r=this.rows,s=this.p.colModel,a=[],l=[],n=[],d=_.jgrid.getRegional(this,"clipboard.errors"),c=0;c<r.length;c++){var p,u=null,g=null,h=r[c];if(h.classList.contains("jqgrow")){for(var f=0;f<h.cells.length;f++)if(h.cells[f].classList.contains("selected-cell")){if(!1===t&&o.push(s[f].name),null===g)try{l.push(_.unformat.call(this,_(h.cells[f]),{rowId:h.id,colModel:s[f]},f))}catch(e){l.push(_.jgrid.htmlDecode(h.cells[f].innerHTML))}g=!0,u=h.id}o.length&&(t=!0)}null!==u&&((p=_(this).jqGrid("getRowData",u))._id_=u,n.push(p),a.push(u))}o.shift(),_.jgrid.isLocalStorage()?(localStorage.removeItem(this.id+"_restore"),localStorage.setItem(this.id+"_restore",JSON.stringify(n))):_.jgrid.toast({text:d.local_stor_err,autoCloseTime:4500,styleUI:this.p.styleUI,type:"warning"});for(let t=0;t<a.length;t++){i={};for(let e=0;e<o.length;e++)i[o[e]]=l[t];_(this).jqGrid("setRowData",a[t],i)}e.startCellIndex=null,e.startRowIndex=null}}),_.jgrid.extend({bindSelection:function(p){return this.each(function(){function i(e,t){for(var i,o,r=e.parent(),e=e.index(),s=(r=r.index())<p.startRowIndex?(i=r,p.startRowIndex):(i=p.startRowIndex,r),a=e<p.startCellIndex?(o=e,p.startCellIndex):(o=p.startCellIndex,e),l=i;l<=s;l++)for(var n=t.find("tr").eq(l).find("td"),d=o;d<=a;d++)n.eq(d).addClass(c)}var c="selected-cell",o=_("#"+_.jgrid.jqID(this.p.id)),r=this;o.find("td").on("mousedown.jqgselect",function(e){var t;return 3===e.which?(t=_("#gbox_"+r.id)[0].getBoundingClientRect(),_("#"+r.p.id+"_copypaste").css({left:e.clientX-t.left,top:e.clientY-t.top}).show()):(p.isMouseDown=!0,t=_(this),o.find("."+c).removeClass(c),e.shiftKey?i(t,o):(t.addClass(c),p.startCellIndex=t.index(),p.startRowIndex=t.parent().index())),!1}).on("mouseover.jqgselect",function(){p.isMouseDown&&(o.find("."+c).removeClass(c),i(_(this),o))}).on("selectstart.jqgselect",function(){return!1})})},startClipboard:function(e){var n=_.extend({copy_delimiter:"\t",copy_newline:"\n",copy_header_included:!0,copy_formated_data:!0,show_info_after_copy:!0,paste_delimiter:"\t",paste_newline:"\n",paste_autodetect_delim:!0,paste_header_included:!1,paste_skip_formatter:!0,show_info_after_paste:!0,beforeCopyData:null,afterCopyData:null,beforePasteData:null,afterPasteData:null,menuConfig:{copy:!0,paste:!0,paste_add:!0,row_vertical:!0,row_horizontal:!0,undo:!0,cancel:!0},toastPosition:"top center",userMenus:[],startCellIndex:null,startRowIndex:null,isMouseDown:!1},e||{});return this.each(function(){var e,t=_.jgrid.styleUI[this.p.styleUI||"jQueryUI"].colmenu,i=this,t='<ul id="'+this.id+'_copypaste" class="ui-search-menu modal-content column-menu ui-menu jqgrid-caption-menu '+t.menu_widget+'" role="menu" tabindex="0"></ul>',t=(_("#gbox_"+this.id).append(t),_.jgrid.getRegional(this,"clipboard.menus")),o=_.jgrid.styleUI[this.p.styleUI||"jQueryUI"].clipboard,r=_.jgrid.styleUI[this.p.styleUI||"jQueryUI"].common.icon_base,s=[],a=[],l=(s.copy={id:"copy_act",icon:r+" "+o.icon_copy,title:t.copy_act,click:function(){_.jgrid.copyRows(this.rows,this.p.colModel,n)}},s.paste={id:"paste_act",icon:r+" "+o.icon_paste,title:t.paste_act,click:function(){_.jgrid.pasteRows.call(this,n,!1)}},s.paste_add={id:"paste_act_add",icon:r+" "+o.icon_paste_add,title:t.paste_act_add,click:function(){_.jgrid.pasteRows.call(this,n,!0)}},s.row_vertical={id:"repeat_act_row",icon:r+" "+o.icon_repeat_row,title:t.repeat_act_row,click:function(){_.jgrid.repeatRow.call(this,n)}},s.row_horizontal={id:"repeat_act_col",icon:r+" "+o.icon_repeat_col,title:t.repeat_act_col,click:function(){_.jgrid.repeatCol.call(this,n)}},s.undo={id:"undo_act",icon:r+" "+o.icon_undo,title:t.undo_act,click:function(){_.jgrid.undoPaste(this.id,n)}},s.cancel={id:"cancel_act",icon:r+" "+o.icon_cancel,title:t.cancel_act,click:function(){_("#"+i.p.id+"_copypaste").hide()}},0);for(e in n.menuConfig)Object.hasOwn(n.menuConfig,e)&&!0===n.menuConfig[e]&&(1<++l&&a.push({divider:!0}),a.push(s[e]));if(Array.isArray(n.userMenus))for(let e=0;e<n.userMenus.length;e++)a.push(n.userMenus[e]);_(this).jqGrid("menubarAdd",a,"_copypaste"),_(this).on("jqGridAfterGridComplete.setBindSelections",function(){_(this).jqGrid("bindSelection",n),n.startCellIndex=n.startRowIndex=null}),_(this).on("jqGridRightClickRow.setBindSelections",function(){return!1}),_(document).on("mouseup.jqgclipme",function(){n.isMouseDown=!1}),_("body").on("click.jqgclipme",function(e){if(!_(e.target).closest(".ui-jqgrid-menubar").length)try{_("#"+i.p.id+"_copypaste").hide()}catch(e){}}),_.jgrid.Permissions.call(this),i.p.isClipboard=!0,_(this).jqGrid("bindSelection",n),n.startCellIndex=n.startRowIndex=null})},stopClipboard:function(){return this.each(function(){_("#"+this.p.id+"_copypaste").remove(),_("body").off("click.jqgclipme"),_(document).off("mouseup.jqgclipme"),_(this).off("jqGridAfterGridComplete.setBindSelections").off("jqGridAfterGridComplete.setBindSelections").find("td").removeClass("selected-cell").off("mousedown.jqgselect").off("mouseover.jqgselect").off("selectstart.jqgselect"),this.p.isClipboard=!1})},updateRowsByIndex:function(c,p,u,g){var h=!0;return this.each(function(){var e=_.jgrid.getRegional(this,"clipboard.errors"),t=_.jgrid.getRegional(this,"clipboard.msg");if(Array.isArray(p))if((c=parseInt(c,10))<0)h=!1,_.jgrid.toast({text:e.start_ind_err,styleUI:this.p.styleUI,autoCloseTime:4500,type:"error"});else{for(var i=p.length,o=0,r=[],s=0,a=0;o<i;){var l,n,d=p[o];(n=this.rows[c])&&!0!==g?(l=_(this).jqGrid("getRowData",n.id),_.isEmptyObject(l)||(l._id_=n.id,p[o]._id_=n.id,r.push(l),_(this).jqGrid("setRowData",n.id,d,void 0,!1,u.paste_skip_formatter),a++)):(_(this).jqGrid("addRowData",null,d,"last",null,"frompaste"),s++),o++,c++}r.length&&(_.jgrid.isLocalStorage()?localStorage.setItem(this.id+"_restore",JSON.stringify(r)):_.jgrid.toast({text:e.local_stor_err,autoCloseTime:4500,styleUI:this.p.styleUI,type:"warning"})),u.show_info_after_paste&&_.jgrid.info_dialog(t.info_cap,"<div>"+t.total_row+i+"</div><div>"+t.insert_row+s+"</div><div>"+t.update_row+a+"</div>","",{styleUI:this.p.styleUI,autoClose:!0,autoCloseTime:4500})}else h=!1,_.jgrid.toast({text:e.not_array_err,autoCloseTime:3500,styleUI:this.p.styleUI,type:"error"})}),h}})});