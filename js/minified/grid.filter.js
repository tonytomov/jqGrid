(e=>{"function"==typeof define&&define.amd?define(["jquery","./grid.base","./grid.common"],e):e(jQuery)})(function(C){C.fn.jqFilter=function(e){if("string"==typeof e){var t,r=C.fn.jqFilter[e];if(r)return t=C.makeArray(arguments).slice(1),r.apply(this,t);throw"jqFilter - No such method: "+e}var x=C.extend(!0,{filter:null,columns:[],sortStrategy:null,onChange:null,afterRedraw:null,checkValues:null,error:!1,errmsg:"",errorcheck:!0,showQuery:!0,sopt:null,ops:[],operands:null,numopts:["eq","ne","lt","le","gt","ge","nu","nn","in","ni"],stropts:["eq","ne","bw","bn","ew","en","cn","nc","nu","nn","in","ni"],strarr:["text","string","blob"],groupOps:[{op:"AND",text:"AND"},{op:"OR",text:"OR"}],groupButton:!0,ruleButtons:!0,uniqueSearchFields:!1,direction:"ltr",addsubgrup:"Add subgroup",addrule:"Add rule",delgroup:"Delete group",delrule:"Delete rule",autoencode:!1,unaryOperations:[]},C.jgrid.filter,e||{});return this.each(function(){if(!this.filter){this.p=x,null==this.p.filter&&(this.p.filter={groupOp:this.p.groupOps[0].op,rules:[],groups:[]}),null!=this.p.sortStrategy&&C.jgrid.isFunction(this.p.sortStrategy)&&this.p.columns.sort(this.p.sortStrategy);var e,t,r=this.p.columns.length,j=/msie/i.test(navigator.userAgent)&&!window.opera;if(this.p.initFilter=C.extend(!0,{},this.p.filter),r){for(e=0;e<r;e++)(t=this.p.columns[e]).stype?t.inputtype=t.stype:t.inputtype||(t.inputtype="text"),t.sorttype?t.searchtype=t.sorttype:t.searchtype||(t.searchtype="string"),void 0===t.hidden&&(t.hidden=!1),t.label||(t.label=t.name),t.index&&(t.name=t.index),t.hasOwnProperty("searchoptions")||(t.searchoptions={}),t.hasOwnProperty("searchrules")||(t.searchrules={}),void 0===t.search?t.inlist=!0:t.inlist=t.search;var S=function(){return C("#"+C.jgrid.jqID(x.id))[0]||null},a=S(),F=C.jgrid.styleUI[a.p.styleUI||"jQueryUI"].filter,O=C.jgrid.styleUI[a.p.styleUI||"jQueryUI"].common,l=(this.p.showQuery&&C(this).append("<table class='queryresult "+F.table_widget+"' style='display:block;max-width:440px;border:0px none;' dir='"+this.p.direction+"'><tbody><tr><td class='query'></td></tr></tbody></table>"),function(e,t){var r=[!0,""],a=S();if(C.jgrid.isFunction(t.searchrules))r=t.searchrules.call(a,e,t);else if(C.jgrid&&C.jgrid.checkValues)try{r=C.jgrid.checkValues.call(a,e,-1,t.searchrules,t.label)}catch(e){}r&&r.length&&!1===r[0]&&(x.error=!r[0],x.errmsg=r[1])});this.onchange=function(){return this.p.error=!1,this.p.errmsg="",!!C.jgrid.isFunction(this.p.onChange)&&this.p.onChange.call(this,this.p)},this.reDraw=function(){C(this).find("table.group").first().remove();var e=this.createTableForGroup(x.filter,null);C(this).append(e),C.jgrid.isFunction(this.p.afterRedraw)&&this.p.afterRedraw.call(this,this.p)},this.createTableForGroup=function(a,e){var s=this,t=C("<table class='group "+F.table_widget+" ui-search-table' style='border:0px none;'><tbody></tbody></table>"),r="left",i=("rtl"===this.p.direction&&(r="right",t.attr("dir","rtl")),null===e&&t.append("<tr class='error' style='display:none;'><th colspan='5' class='"+O.error+"' align='"+r+"'></th></tr>"),C("<tr></tr>")),r=(t.append(i),C("<th colspan='5' align='"+r+"'></th>"));if(i.append(r),!0===this.p.ruleButtons){for(var l,o=C("<select size='1' aria-label='Select group operation' name='select_group_op' class='opsel "+F.srSelect+"'></select>"),n=(r.append(o),""),p=0;p<x.groupOps.length;p++)l=a.groupOp===s.p.groupOps[p].op?" selected='selected'":"",n+="<option value='"+s.p.groupOps[p].op+"'"+l+">"+s.p.groupOps[p].text+"</option>";o.append(n).on("change",function(){a.groupOp=C(o).val(),s.onchange()})}var c,i="<span></span>";if(this.p.groupButton&&(i=C("<input type='button' value='+ {}' title='"+s.p.addsubgrup+"' class='add-group "+O.button+"' name='newsubgroup'/>")).on("click",function(){return void 0===a.groups&&(a.groups=[]),a.groups.push({groupOp:x.groupOps[0].op,rules:[],groups:[]}),s.reDraw(),s.onchange(),!1}),r.append(i),!0===this.p.ruleButtons&&((i=C("<input type='button' value='+' title='"+s.p.addrule+"' class='add-rule ui-add "+O.button+"'/ name='newrule'>")).on("click",function(){for(void 0===a.rules&&(a.rules=[]),p=0;p<s.p.columns.length;p++){var e=void 0===s.p.columns[p].search||s.p.columns[p].search,t=!0===s.p.columns[p].hidden;if(!0===s.p.columns[p].searchoptions.searchhidden&&e||e&&!t){c=s.p.columns[p];break}}var r;return c&&(r=c.searchoptions.sopt||s.p.sopt||(-1!==C.inArray(c.searchtype,s.p.strarr)?s.p.stropts:s.p.numopts),a.rules.push({field:c.name,op:r[0],data:""}),s.reDraw()),!1}),r.append(i)),null!==e&&(i=C("<input type='button' value='-' title='"+s.p.delgroup+"' class='delete-group "+O.button+"'/ name='delgroup'>"),r.append(i),i.on("click",function(){for(p=0;p<e.groups.length;p++)if(e.groups[p]===a){e.groups.splice(p,1);break}return s.reDraw(),s.onchange(),!1})),void 0!==a.groups)for(p=0;p<a.groups.length;p++){var d=C("<tr></tr>"),u=(t.append(d),C("<td class='first'></td>")),u=(d.append(u),C("<td colspan='4'></td>"));u.append(this.createTableForGroup(a.groups[p],a)),d.append(u)}void 0===a.groupOp&&(a.groupOp=s.p.groupOps[0].op);var h=s.p.ruleButtons&&s.p.uniqueSearchFields;if(h)for(f=0;f<s.p.columns.length;f++)s.p.columns[f].inlist&&(s.p.columns[f].search=!0);if(void 0!==a.rules)for(p=0;p<a.rules.length;p++)if(t.append(this.createTableRowForRule(a.rules[p],a)),h)for(var g=a.rules[p].field,f=0;f<s.p.columns.length;f++)if(g===s.p.columns[f].name){s.p.columns[f].search=!1;break}return t},this.createTableRowForRule=function(i,e){for(var l,o,n,t,p,c=this,d=S(),r=C("<tr></tr>"),a="",s=(r.append("<td class='first'></td>"),C("<td class='columns'></td>")),u=(r.append(s),C("<select size='1' aria-label='Select Field' name='select_field' class='"+F.srSelect+"'></select>")),h=[],g=(s.append(u),u.on("change",function(){var e;for(c.p.ruleButtons&&c.p.uniqueSearchFields&&(t=parseInt(C(this).data("curr"),10),e=this.selectedIndex,0<=t)&&(c.p.columns[t].search=!0,C(this).data("curr",e),c.p.columns[e].search=!1),i.field=C(u).val(),o=C(this).parents("tr").first(),C(".data",o).empty(),f=0;f<c.p.columns.length;f++)if(c.p.columns[f].name===i.field){n=c.p.columns[f];break}if(n){n.searchoptions.id=C.jgrid.randId(),n.searchoptions.name=i.field,n.searchoptions.oper="filter",n.searchoptions["aria-label"]="Enter value to search",!j||"text"!==n.inputtype||n.searchoptions.size||(n.searchoptions.size=10);var t,r=C.jgrid.createEl.call(d,n.inputtype,n.searchoptions,"",!0,c.p.ajaxSelectOptions||{},!0),a=(C(r).addClass("input-elm "+("select"===n.inputtype?F.srSelect:F.srInput)),l=n.searchoptions.sopt||c.p.sopt||(-1!==C.inArray(n.searchtype,c.p.strarr)?c.p.stropts:c.p.numopts),""),s=0;for(h=[],C.each(c.p.ops,function(){h.push(this.oper)}),f=0;f<l.length;f++)-1!==(p=C.inArray(l[f],h))&&(0===s&&(i.op=c.p.ops[p].oper),a+="<option value='"+c.p.ops[p].oper+"'>"+c.p.ops[p].text+"</option>",s++);C(".selectopts",o).empty().append(a),C(".selectopts",o)[0].selectedIndex=0,C.jgrid.msie()&&C.jgrid.msiever()<9&&(t=parseInt(C("select.selectopts",o)[0].offsetWidth,10)+1,C(".selectopts",o).width(t),C(".selectopts",o).css("width","auto")),C(".data",o).append(r),C.jgrid.bindEv.call(d,r,n.searchoptions),C(".input-elm",o).on("change",function(e){e=e.target;"custom"===n.inputtype&&C.jgrid.isFunction(n.searchoptions.custom_value)?i.data=n.searchoptions.custom_value.call(d,C(".customelement",this),"get"):i.data=C(e).val(),"select"===n.inputtype&&n.searchoptions.multiple&&(i.data=i.data.join(",")),c.onchange()}),setTimeout(function(){i.data=C(r).val(),("nu"===i.op||"nn"===i.op||0<=C.inArray(i.op,c.p.unaryOperations))&&(C(r).attr("readonly","true"),C(r).attr("disabled","true")),"select"===n.inputtype&&n.searchoptions.multiple&&Array.isArray(i.data)&&(i.data=i.data.join(",")),c.onchange()},0)}}),0),f=0;f<c.p.columns.length;f++){var m=void 0===c.p.columns[f].search||c.p.columns[f].search,y=!0===c.p.columns[f].hidden;(!0===c.p.columns[f].searchoptions.searchhidden&&m||m&&!y)&&(t="",i.field===c.p.columns[f].name&&(t=" selected='selected'",g=f),a+="<option value='"+c.p.columns[f].name+"'"+t+">"+c.p.columns[f].label+"</option>")}u.append(a),u.data("curr",g);var s=C("<td class='operators'></td>"),v=(r.append(s),(n=x.columns[g]).searchoptions.id=C.jgrid.randId(),!j||"text"!==n.inputtype||n.searchoptions.size||(n.searchoptions.size=10),n.searchoptions.name=i.field,n.searchoptions.oper="filter",n.searchoptions["aria-label"]="Enter value to search",C.jgrid.createEl.call(d,n.inputtype,n.searchoptions,i.data,!0,c.p.ajaxSelectOptions||{},!0)),b=(("nu"===i.op||"nn"===i.op||0<=C.inArray(i.op,c.p.unaryOperations))&&(C(v).attr("readonly","true"),C(v).attr("disabled","true")),C("<select size='1' aria-label='Select operation' name='select_oper' class='selectopts "+F.srSelect+"'></select>"));for(s.append(b),b.on("change",function(){i.op=C(b).val(),o=C(this).parents("tr").first();var e=C(".input-elm",o)[0];"nu"===i.op||"nn"===i.op||0<=C.inArray(i.op,c.p.unaryOperations)?(i.data="","SELECT"!==e.tagName.toUpperCase()&&(e.value=""),e.setAttribute("readonly","true"),e.setAttribute("disabled","true")):("SELECT"===e.tagName.toUpperCase()&&(i.data=e.value),e.removeAttribute("readonly"),e.removeAttribute("disabled")),c.onchange()}),l=n.searchoptions.sopt||c.p.sopt||(-1!==C.inArray(n.searchtype,c.p.strarr)?c.p.stropts:c.p.numopts),a="",C.each(c.p.ops,function(){h.push(this.oper)}),f=0;f<l.length;f++)-1!==(p=C.inArray(l[f],h))&&(t=i.op===c.p.ops[p].oper?" selected='selected'":"",a+="<option value='"+c.p.ops[p].oper+"'"+t+">"+c.p.ops[p].text+"</option>");b.append(a);s=C("<td class='data'></td>"),r.append(s),s.append(v),C.jgrid.bindEv.call(d,v,n.searchoptions),C(v).addClass("input-elm "+("select"===n.inputtype?F.srSelect:F.srInput)).on("change",function(){i.data="custom"===n.inputtype?n.searchoptions.custom_value.call(d,C(".customelement",this),"get"):C(this).val(),c.onchange()}),s=C("<td></td>");return r.append(s),!0===this.p.ruleButtons&&(v=C("<input type='button' value='-' title='"+c.p.delrule+"' class='delete-rule ui-del "+O.button+"'/ name='delrule'>"),s.append(v),v.on("click",function(){for(f=0;f<e.rules.length;f++)if(e.rules[f]===i){e.rules.splice(f,1);break}return c.reDraw(),c.onchange(),!1})),r},this.getStringForGroup=function(e){var t,r="(";if(void 0!==e.groups)for(t=0;t<e.groups.length;t++){1<r.length&&(r+=" "+e.groupOp+" ");try{r+=this.getStringForGroup(e.groups[t])}catch(e){alert(e)}}if(void 0!==e.rules)try{for(t=0;t<e.rules.length;t++)1<r.length&&(r+=" "+e.groupOp+" "),r+=this.getStringForRule(e.rules[t])}catch(e){alert(e)}return"()"===(r+=")")?"":r},this.getStringForRule=function(e){for(var t,r,a="",s="",i=0;i<this.p.ops.length;i++)if(this.p.ops[i].oper===e.op){a=this.p.operands.hasOwnProperty(e.op)?this.p.operands[e.op]:"",s=this.p.ops[i].oper;break}for(i=0;i<this.p.columns.length;i++)if(this.p.columns[i].name===e.field){t=this.p.columns[i];break}return void 0===t?"":(r=this.p.autoencode?C.jgrid.htmlEncode(e.data):e.data,"bw"!==s&&"bn"!==s||(r+="%"),"ew"!==s&&"en"!==s||(r="%"+r),"cn"!==s&&"nc"!==s||(r="%"+r+"%"),"in"!==s&&"ni"!==s||(r=" ("+r+")"),x.errorcheck&&l(e.data,t),-1!==C.inArray(t.searchtype,["int","integer","float","number","currency"])||"nn"===s||"nu"===s||0<=C.inArray(e.op,this.p.unaryOperations)?e.field+" "+a+" "+r:e.field+" "+a+' "'+r+'"')},this.resetFilter=function(){this.p.filter=C.extend(!0,{},this.p.initFilter),this.reDraw(),this.onchange()},this.hideError=function(){C("th."+O.error,this).html(""),C("tr.error",this).hide()},this.showError=function(){C("th."+O.error,this).html(C.jgrid.stripScript(this.p.errmsg)),C("tr.error",this).show()},this.toUserFriendlyString=function(){return this.getStringForGroup(x.filter)},this.toString=function(){var s=this;return function e(t){var r,a="(";if(void 0!==t.groups)for(r=0;r<t.groups.length;r++)1<a.length&&("OR"===t.groupOp?a+=" || ":a+=" && "),a+=e(t.groups[r]);if(void 0!==t.rules)for(r=0;r<t.rules.length;r++)1<a.length&&("OR"===t.groupOp?a+=" || ":a+=" && "),a+=(e=>{if(s.p.errorcheck){for(var t,r=0;r<s.p.columns.length;r++)if(s.p.columns[r].name===e.field){t=s.p.columns[r];break}t&&l(e.data,t)}return e.op+"(item."+e.field+",'"+e.data+"')"})(t.rules[r]);return"()"==(a+=")")?"":a}(this.p.filter)},this.reDraw(),this.p.showQuery&&this.onchange(),this.filter=!0}}})},C.extend(C.fn.jqFilter,{toSQLString:function(){var e="";return this.each(function(){e=this.toUserFriendlyString()}),e},filterData:function(){var e;return this.each(function(){e=this.p.filter}),e},getParameter:function(r){var a=null;return void 0!==r&&this.each(function(e,t){t.p.hasOwnProperty(r)&&(a=t.p[r])}),a||this[0].p},resetFilter:function(){return this.each(function(){this.resetFilter()})},addFilter:function(e){"string"==typeof e&&(e=C.jgrid.parse(e)),this.each(function(){this.p.filter=e,this.reDraw(),this.onchange()})}}),C.extend(C.jgrid,{filterRefactor:function(e){var t,r,a,s,i,l,o={};try{if((o="string"==typeof e.ruleGroup?C.jgrid.parse(e.ruleGroup):e.ruleGroup).rules&&o.rules.length)for(t=o.rules,r=0;r<t.length;r++)l=(a=t[r]).field,-1<C.inArray(l,e.ssfield)&&1<(s=a.data.split(e.splitSelect)).length&&(void 0===o.groups&&(o.groups=[]),i={groupOp:e.groupOpSelect,groups:[],rules:[]},o.groups.push(i),C.each(s,function(e){s[e]&&i.rules.push({data:s[e],op:a.op,field:a.field})}),t.splice(r,1),r--)}catch(e){}return o}}),C.jgrid.extend({filterToolbar:function(I){var a=C.jgrid.getRegional(this[0],"search");return I=C.extend({autosearch:!0,autosearchDelay:500,searchOnEnter:!0,beforeSearch:null,afterSearch:null,beforeClear:null,afterClear:null,onClearSearchValue:null,url:"",stringResult:!1,groupOp:"AND",defaultSearch:"bw",searchOperators:!1,resetIcon:"x",splitSelect:",",groupOpSelect:"OR",errorcheck:!0,operands:{eq:"==",ne:"!",lt:"<",le:"<=",gt:">",ge:">=",bw:"^",bn:"!^",in:"=",ni:"!=",ew:"|",en:"!@",cn:"~",nc:"!~",nu:"#",nn:"!#",bt:"..."},disabledKeys:[9,16,17,18,19,20,33,34,35,36,37,38,39,40,30,45,112,113,114,115,116,117,118,119,120,121,122,123,144,145]},a,I||{}),this.each(function(){var q=this,w=[];if(!q.p.filterToolbar){if(C(q).data("filterToolbar")||C(q).data("filterToolbar",I),q.p.force_regional&&(I=C.extend(I,a)),void 0!==q.p.customFilterDef)for(var e in q.p.customFilterDef)q.p.customFilterDef.hasOwnProperty(e)&&!I.operands.hasOwnProperty(e)&&(I.odata.push({oper:e,text:q.p.customFilterDef[e].text}),I.operands[e]=q.p.customFilterDef[e].operand,!0===q.p.customFilterDef[e].unary)&&w.push(e);var u,h,t,g,f=C.jgrid.styleUI[q.p.styleUI||"jQueryUI"].filter,c=C.jgrid.styleUI[q.p.styleUI||"jQueryUI"].common,m=C.jgrid.styleUI[q.p.styleUI||"jQueryUI"].base,y=function(e){void 0===e&&(e=1);var t,r,a,s,i={},l=0,o={},n=!1,p=[],c=[],d=[],u=!1,h=[!0,"",""],g=!1;if(C.each(q.p.colModel,function(){var e;if(r=this.index||this.name,s=this.searchoptions||{},void 0===(e=C("#gs_"+q.p.idPrefix+C.jgrid.jqID(this.name),q.grid.hDiv))[0]&&(e=C("#gs_"+q.p.idPrefix+C.jgrid.jqID(this.name),q.grid.hDiv)),a=I.searchOperators&&s.searchOperMenu?e.parents("table.ui-search-table").find("td.ui-search-oper").children("a").attr("soper")||I.defaultSearch:s.sopt?s.sopt[0]:"select"===this.stype?"eq":I.defaultSearch,"custom"===this.stype&&C.jgrid.isFunction(s.custom_value)&&0<e.length?(t=s.custom_value.call(q,e,"get"),d.push(r)):t=e.val(),"select"===this.stype&&s.multiple&&Array.isArray(t)?t=0<t.length?(n=!0,p.push(r),1===t.length?t[0]:t):"":"bt"!==a&&"text"===this.stype&&!0===s.splitSearchWord&&c.push(r),this.searchrules&&I.errorcheck&&(C.jgrid.isFunction(this.searchrules)?h=this.searchrules.call(q,t,this):C.jgrid&&C.jgrid.checkValues&&(h=C.jgrid.checkValues.call(q,t,-1,this.searchrules,this.label||this.name)),h)&&h.length&&!1===h[0])return this.searchrules.hasOwnProperty("validationError")&&(g=this.searchrules.validationError),!1;if("bt"===a&&(u=!0),C.jgrid.isServiceCol(r)||(r,0),t||"nu"===a||"nn"===a||0<=C.inArray(a,w))i[r]=t,o[r]=a,l++;else try{delete q.p.postData[r]}catch(e){}}),!1===h[0])C.jgrid.isFunction(g)?g.call(q,h[1]):(m=C.jgrid.getRegional(q,"errors"),C.jgrid.info_dialog(m.errcap,h[1],"",{styleUI:q.p.styleUI}));else{var f,m=0<l;if(!0===I.stringResult||"local"===q.p.datatype||!0===I.searchOperators){var y,v,b,j,S,F,O='{"groupOp":"'+I.groupOp+'","rules":[',x=0;if(C.each(i,function(e,t){0<x&&(O+=","),O=(O=(O+='{"field":"'+e+'",')+'"op":"'+o[e]+'",')+'"data":"'+(t+="").replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"}',x++}),O+="]}",n&&(y=C.jgrid.filterRefactor({ruleGroup:O,ssfield:p,splitSelect:I.splitSelect,groupOpSelect:I.groupOpSelect})),u&&(y=C.isPlainObject(y)?y:C.jgrid.parse(O)).rules&&y.rules.length)for(v=y.rules,b=0;b<v.length;b++)"bt"===(j=v[b]).op&&1<(S=j.data.split("...")).length&&(void 0===y.groups&&(y.groups=[]),F={groupOp:"AND",groups:[],rules:[]},y.groups.push(F),C.each(S,function(e){S[e]&&F.rules.push({data:S[e],op:0===e?"ge":"le",field:j.field})}),v.splice(b,1),b--);c.length&&(y=C.jgrid.filterRefactor({ruleGroup:O,ssfield:c,splitSelect:s.splitSearchSeparator||";",groupOpSelect:"OR"})),(u||n||c.length)&&(O=JSON.stringify(y)),!0===q.p.mergeSearch&&q.p.searchModules.hasOwnProperty("filterToolbar")&&!1!==q.p.searchModules.filterToolbar?(q.p.searchModules.filterToolbar=0<x?O:null,m=!0,C.extend(q.p.postData,{filters:C.jgrid.splitSearch(q.p.searchModules)})):C.extend(q.p.postData,{filters:O}),C.each(["searchField","searchString","searchOper"],function(e,t){q.p.postData.hasOwnProperty(t)&&delete q.p.postData[t]})}else C.extend(q.p.postData,i);I.url&&(f=q.p.url,C(q).jqGrid("setGridParam",{url:I.url}));document.activeElement;var D="stop"===C(q).triggerHandler("jqGridToolbarBeforeSearch");(D=!D&&C.jgrid.isFunction(I.beforeSearch)?I.beforeSearch.call(q):D)||C(q).jqGrid("setGridParam",{search:m}).trigger("reloadGrid",[{page:e}]),f&&C(q).jqGrid("setGridParam",{url:f}),C(q).triggerHandler("jqGridToolbarAfterSearch"),C.jgrid.isFunction(I.afterSearch)&&I.afterSearch.call(q)}},v=C("<tr class='ui-search-toolbar' role='row'></tr>"),b=(I.restoreFromFilters&&(t=!0===q.p.mergeSearch&&q.p.searchModules.hasOwnProperty("filterToolbar")&&!1!==q.p.searchModules.filterToolbar?q.p.searchModules.filterToolbar:q.p.postData.filters)&&("string"==typeof t&&(t=C.jgrid.parse(t)),h=!(!t.rules||!t.rules.length)&&t.rules),new Set(I.disabledKeys));if(b.size!==I.disabledKeys.length)for(var r=0;r<I.disabledKeys.length;r++)(b=new Set).add(I.disabledKeys[r]);a.filterFor&&(g=a.filterFor),q.p.colSpanHeader.length&&C(q).jqGrid("destroyColSpanHeader",!1),C.each(q.p.colModel,function(e){var t,r,a,s=this,i="",l="=",o=C("<th role='columnheader' class='"+m.headerBox+" ui-th-"+q.p.direction+" "+(s.labelClasses||"")+"' id='gsh_"+q.p.id+"_"+s.name+"'></th>"),n=C('<div><span aria-label="empty" style="display: none;">empty</span></div>'),p=C("<table class='ui-search-table' cellspacing='0'><tr><td class='ui-search-oper' headers=''></td><td class='ui-search-input' headers=''></td><td class='ui-search-clear' headers=''></td></tr></table>");if(!0===this.hidden&&C(o).css("display","none"),this.search=!1!==this.search,void 0===this.stype&&(this.stype="text"),this.searchoptions=this.searchoptions||{},void 0===this.searchoptions.searchOperMenu&&(this.searchoptions.searchOperMenu=!0),e=void 0!==g?g+" "+q.p.colNames[e]:q.p.colNames[e],t=C.extend({},this.searchoptions,{name:s.index||s.name,id:"gs_"+q.p.idPrefix+s.name,oper:"search",title:e}),this.search){if(I.restoreFromFilters&&h)for(var c=!1,d=0;d<h.length;d++)if(h[d].field)if((s.index||s.name)===h[d].field){c=h[d];break}if(I.searchOperators){for(r=t.sopt?t.sopt[0]:"select"===s.stype?"eq":I.defaultSearch,I.restoreFromFilters&&c&&(r=c.op),a=0;a<I.odata.length;a++)if(I.odata[a].oper===r){l=I.operands[r]||"";break}e=null!=t.searchtitle?t.searchtitle:I.operandTitle,i=this.searchoptions.searchOperMenu?"<a title='"+e+"' soper='"+r+"' class='soptclass' colname='"+this.name+"'>"+l+"</a>":""}switch(C("td",p).eq(0).attr("columname",s.name).append(i),void 0===t.clearSearch&&(t.clearSearch=!0),t.clearSearch?(e=I.resetTitle||"Clear Search Value",C("td",p).eq(2).append("<a title='"+e+"' tabindex='0' style='padding-right: 0.3em;padding-left: 0.3em;' class='clearsearchclass'>"+I.resetIcon+"</a>")):C("td",p).eq(2).hide(),this.surl&&(t.dataUrl=this.surl),e="",t.defaultValue&&(e=C.jgrid.isFunction(t.defaultValue)?t.defaultValue.call(q):t.defaultValue),I.restoreFromFilters&&c&&(e=c.data),t["aria-label"]="Enter toolbar search value",e=C.jgrid.createEl.call(q,this.stype,t,e,!1,C.extend({},C.jgrid.ajaxOptions,q.p.ajaxSelectOptions||{})),"custom"!==this.stype&&("select"===this.stype?C(e).addClass(f.srSelect):C(e).addClass(f.srInput)),C("td",p).eq(1).append(e),C(n).append(p),null==t.dataEvents&&(t.dataEvents=[]),this.stype){case"select":!0===I.autosearch&&t.dataEvents.push({type:"change",fn:function(){return y(),!1}});break;case"text":case"custom":!0===I.autosearch&&(I.searchOnEnter?t.dataEvents.push({type:"keypress",fn:function(e){return 13===(e.charCode||e.keyCode||0)?(e.preventDefault(),y(),!1):this}}):t.dataEvents.push({type:"keydown",fn:function(e){var t=e.which;if(!b.has(t)){if(13===t)return e.preventDefault(),!1;u&&clearTimeout(u),u=setTimeout(function(){y()},I.autosearchDelay)}}}))}C.jgrid.bindEv.call(q,e,t)}C(o).append(n),C(v).append(o),I.searchOperators&&""!==i||C("td",p).eq(0).hide()}),C("table thead",q.grid.hDiv).append(v),I.searchOperators&&(C(".soptclass",v).click(function(e){var t=C(this).offset(),r=t.left,a=this,t=t.top;C("#sopt_menu").remove(),r=parseInt(r,10),t=parseInt(t,10)+18;var s,i='<ul id="sopt_menu" class="ui-search-menu modal-content" role="menu" tabindex="0" style="font-size:'+(C(".ui-jqgrid").css("font-size")||"11px")+";left:"+r+"px;top:"+t+'px;">',l=C(a).attr("soper"),o=[],r=C(a).attr("colname"),n=C.jgrid.getElemByAttrVal(q.p.colModel,"name",r,!0);if(-1!==n){var t=q.p.colModel[n],p=C.extend({},t.searchoptions);for(p.sopt||(p.sopt=[],p.sopt[0]="select"===t.stype?"eq":I.defaultSearch),C.each(I.odata,function(){o.push(this.oper)}),n=0;n<p.sopt.length;n++)-1!==(s=C.inArray(p.sopt[n],o))&&(i+='<li class="ui-menu-item '+(l===I.odata[s].oper?c.highlight:"")+'" role="presentation"><a class="'+c.cornerall+' g-menu-item" tabindex="0" role="menuitem" value="'+I.odata[s].oper+'" oper="'+I.operands[I.odata[s].oper]+'"><table class="ui-common-table"><tr><td class="opersign">'+I.operands[I.odata[s].oper]+"</td><td>"+I.odata[s].text+"</td></tr></table></a></li>");i+="</ul>",C("body").append(i),C("#sopt_menu").addClass("ui-menu "+f.menu_widget),C("#sopt_menu > li > a").hover(function(){C(this).addClass(c.hover)},function(){C(this).removeClass(c.hover)}).click(function(){var e=C(this).attr("value"),t=C(this).attr("oper");C(q).triggerHandler("jqGridToolbarSelectOper",[e,t,a]),C("#sopt_menu").hide(),C(a).text(t).attr("soper",e),!0===I.autosearch&&(t=C(a).parent().next().children()[0],C(t).val()||"nu"===e||"nn"===e||0<=C.inArray(e,w))&&y()})}e.stopPropagation()}),C("body").on("click",function(e){"soptclass"!==e.target.className&&C("#sopt_menu").remove()})),C(".clearsearchclass",v).click(function(){var e,t=C(this).parents("tr").first(),r=C("td.ui-search-oper",t).attr("columname"),a=C("td.ui-search-oper a",t).attr("soper");if(-1===(r=C.jgrid.getElemByAttrVal(q.p.colModel,"name",r,!0)))return!1;var s=q.p.colModel[r],i=C.extend({},s.searchoptions||{}),l=i.defaultValue||"",o=("select"===s.stype?(o=C("td.ui-search-input select",t),l?o.val(l):o[0].selectedIndex=0):(o=C("td.ui-search-input input",t)).val(l),C(q).triggerHandler("jqGridToolbarClearVal",[o[0],r,i,l]),C.jgrid.isFunction(I.onClearSearchValue)&&I.onClearSearchValue.call(q,o[0],r,i,l),"");("nu"===a||"nn"===a||0<=C.inArray(a,w))&&(e=i.sopt?i.sopt[0]:"select"===s.stype?"eq":I.defaultSearch,o=null!=q.p.customFilterDef&&null!=q.p.customFilterDef[e]?q.p.customFilterDef[e].operand:I.operands[e]||"",(e===a?C("td.ui-search-oper a",t).attr("soper","dummy"):C("td.ui-search-oper a",t).attr("soper",e)).text(o)),!0===I.autosearch&&(y(),e===a)&&C("td.ui-search-oper a",t).attr("soper",e).text(o)}),C(".clearsearchclass",v).keydown(function(e){13===e.keyCode&&(e.preventDefault(),C(".clearsearchclass",v).trigger("click"))}),C(q.grid.hDiv).on("scroll",function(e){q.grid.hScroll||(q.grid.bScroll=!0,q.grid.bDiv.scrollLeft=q.grid.hDiv.scrollLeft,q.p.footerrow&&(q.grid.sDiv.scrollLeft=q.grid.bDiv.scrollLeft),q.p.headerrow&&(q.grid.hrDiv.scrollLeft=q.grid.bDiv.scrollLeft)),q.grid.hScroll=!1}),q.p.colSpanHeader.length&&setTimeout(function(){C(q).jqGrid("setColSpanHeader")},0),this.p.filterToolbar=!0,this.triggerToolbar=y,this.clearToolbar=function(e){var t,r,a,s,i,l,o={},n={},p=0,c=(e="boolean"!=typeof e||e,C.each(q.p.colModel,function(){switch(r=C("#gs_"+q.p.idPrefix+C.jgrid.jqID(this.name),q.grid.hDiv),a=this.searchoptions&&void 0!==this.searchoptions.defaultValue?this.searchoptions.defaultValue:void 0,t=this.index||this.name,n[t]=this.searchoptions&&this.searchoptions.sopt?this.searchoptions.sopt[0]:I.defaultSearch||"eq",this.stype){case"select":if(r.find("option").each(function(e){if(0===e&&(this.selected=!0),C(this).val()===a)return!(this.selected=!0)}),void 0!==a)o[t]=a,p++;else try{delete q.p.postData[t]}catch(e){}break;case"text":if(r.val(a||""),void 0!==a)o[t]=a,p++;else try{delete q.p.postData[t]}catch(e){}break;case"custom":C.jgrid.isFunction(this.searchoptions.custom_value)&&0<r.length&&this.searchoptions.custom_value.call(q,r,"set",a||"")}}),0<p),d=((q.p.resetsearch=!0)===I.stringResult||"local"===q.p.datatype?(s='{"groupOp":"'+I.groupOp+'","rules":[',i=0,C.each(o,function(e,t){0<i&&(s+=","),s=(s=(s+='{"field":"'+e+'",')+'"op":"'+n[e]+'",')+'"data":"'+(t+="").replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"}',i++,I.searchOperators&&(r=C("#gs_"+q.p.idPrefix+C.jgrid.jqID(e),q.grid.hDiv)).parents("table.ui-search-table").find("td.ui-search-oper").children("a").attr("soper",n[e]).html(I.operands[n[e]])}),s+="]}",!0===q.p.mergeSearch&&q.p.searchModules.hasOwnProperty("filterToolbar")&&!1!==q.p.searchModules.filterToolbar?(q.p.searchModules.filterToolbar=0<i?s:null,c=!0,C.extend(q.p.postData,{filters:C.jgrid.splitSearch(q.p.searchModules)})):C.extend(q.p.postData,{filters:s}),C.each(["searchField","searchString","searchOper"],function(e,t){q.p.postData.hasOwnProperty(t)&&delete q.p.postData[t]})):C.extend(q.p.postData,o),I.url&&(l=q.p.url,C(q).jqGrid("setGridParam",{url:I.url})),"stop"===C(q).triggerHandler("jqGridToolbarBeforeClear"));(d=!d&&C.jgrid.isFunction(I.beforeClear)?I.beforeClear.call(q):d)||e&&C(q).jqGrid("setGridParam",{search:c}).trigger("reloadGrid",[{page:1}]),l&&C(q).jqGrid("setGridParam",{url:l}),C(q).triggerHandler("jqGridToolbarAfterClear"),C.jgrid.isFunction(I.afterClear)&&I.afterClear()},this.toggleToolbar=function(){var e=C("tr.ui-search-toolbar",q.grid.hDiv);"none"===e.css("display")?e.show():e.hide()}}})},destroyFilterToolbar:function(){return this.each(function(){this.p.filterToolbar&&(this.triggerToolbar=null,this.clearToolbar=null,this.toggleToolbar=null,this.p.filterToolbar=!1,C(this.grid.hDiv).find("table thead tr.ui-search-toolbar").remove())})},refreshFilterToolbar:function(g){return g=C.extend(!0,{filters:"",onClearVal:null,onSetVal:null},g||{}),this.each(function(){var s,i,l,e,o,n,p,c=this,d=c.p.colModel,u=c.p.colModel.length,h=[];if(c.p.filterToolbar){for(i=C(c).data("filterToolbar"),s=0;s<u;s++){switch(h.push(d[s].index||d[s].name),l=C("#gs_"+c.p.idPrefix+C.jgrid.jqID(d[s].name)),d[s].stype){case"select":case"text":l.val("")}C.jgrid.isFunction(g.onClearVal)&&g.onClearVal.call(c,l,d[s].name)}"string"==typeof g.filters&&(g.filters.length?e=g.filters:c.p.postData.hasOwnProperty("filters")&&(e=c.p.postData.filters),e=C.jgrid.parse(e)),C.isPlainObject(e)&&!function e(t){if(t&&t.rules){for(o=t.rules,u=o.length,s=0;s<u;s++){var r;n=o[s],-1!==(p=C.inArray(n.field,h))&&0<(l=C("#gs_"+c.p.idPrefix+C.jgrid.jqID(d[p].name))).length&&("select"===d[p].stype?l.find("option[value='"+C.jgrid.jqID(n.data)+"']").prop("selected",!0):"text"===d[p].stype&&l.val(n.data),C.jgrid.isFunction(g.onSetVal)&&g.onSetVal.call(c,l,d[p].name),i)&&i.searchOperators&&(r=l.parent().prev()).hasClass("ui-search-oper")&&(C(".soptclass",r).attr("soper",n.op),i.operands.hasOwnProperty(n.op))&&C(".soptclass",r).html(C.jgrid.stripScript(i.operands[n.op]))}if(t.groups)for(var a=0;a<t.groups.length;a++)e(t.groups[a])}}(e)}})},searchGrid:function(T){var e=C.jgrid.getRegional(this[0],"search");return T=C.extend(!0,{recreateFilter:!1,drag:!0,sField:"searchField",sValue:"searchString",sOper:"searchOper",sFilter:"filters",loadDefaults:!0,beforeShowSearch:null,afterShowSearch:null,onInitializeSearch:null,afterRedraw:null,afterChange:null,sortStrategy:null,closeAfterSearch:!1,closeAfterReset:!1,closeOnEscape:!1,searchOnEnter:!1,multipleSearch:!1,multipleGroup:!1,top:0,left:0,jqModal:!0,modal:!1,resize:!0,width:450,height:"auto",dataheight:"auto",showQuery:!1,errorcheck:!0,sopt:null,stringResult:void 0,onClose:null,onSearch:null,onReset:null,toTop:!0,overlay:30,columns:[],tmplNames:null,tmplFilters:null,tmplLabel:" Template: ",showOnLoad:!1,layer:null,splitSelect:",",groupOpSelect:"OR",operands:{eq:"=",ne:"<>",lt:"<",le:"<=",gt:">",ge:">=",bw:"LIKE",bn:"NOT LIKE",in:"IN",ni:"NOT IN",ew:"LIKE",en:"NOT LIKE",cn:"LIKE",nc:"NOT LIKE",nu:"IS NULL",nn:"ISNOT NULL"},buttons:[]},e,T||{}),this.each(function(){var a=this;if(a.grid){var t,r,s="fbox_"+a.p.id,i=!0,l=!0,o={themodal:"searchmod"+s,modalhead:"searchhd"+s,modalcontent:"searchcnt"+s,scrollelm:s},e=[],n=C.jgrid.styleUI[a.p.styleUI||"jQueryUI"].filter,p=C.jgrid.styleUI[a.p.styleUI||"jQueryUI"].common;if(T.styleUI=a.p.styleUI,"string"==typeof(t=C.isPlainObject(a.p._savedFilter)&&!C.isEmptyObject(a.p._savedFilter)?a.p._savedFilter:(!0===a.p.mergeSearch&&a.p.searchModules.hasOwnProperty("searchGrid")&&!1!==a.p.searchModules.searchGrid&&C.extend(a.p.postData,{filters:C.jgrid.splitSearch(a.p.searchModules)}),a.p.postData[T.sFilter]))&&(t=C.jgrid.parse(t)),!0===T.recreateFilter&&C("#"+C.jgrid.jqID(o.themodal)).remove(),void 0!==C("#"+C.jgrid.jqID(o.themodal))[0])G(C("#fbox_"+C.jgrid.jqID(a.p.id)));else{var c,d,u=C("<div><div id='"+s+"' class='searchFilter' style='overflow:auto'></div></div>").insertBefore("#gview_"+C.jgrid.jqID(a.p.id)),h="left",g="",f=("rtl"===a.p.direction&&(h="right",g=" style='text-align:left'",u.attr("dir","rtl")),C.extend([],a.p.colModel)),m="<a id='"+s+"_search' class='fm-button "+p.button+" fm-button-icon-right ui-search' role='button' tabindex='0' href='#'><span class='"+p.icon_base+" "+n.icon_search+"'></span>"+T.Find+"</a>",y="<a id='"+s+"_reset' class='fm-button "+p.button+" fm-button-icon-left ui-reset' role='button' tabindex='0' href='#'><span class='"+p.icon_base+" "+n.icon_reset+"'></span>"+T.Reset+"</a>",v="",b="",j=!1,S=-1,F=!1,O=[],m=(T.showQuery&&(v="<a id='"+s+"_query' class='fm-button "+p.button+" fm-button-icon-left'><span class='"+p.icon_base+" "+n.icon_query+"'></span>Query</a>"),C.jgrid.buildButtons(T.buttons,v+m,p)),x=null;if(C(a).jqGrid("isGroupHeaderOn")&&(_=C("table.ui-jqgrid-htable",a.grid.hDiv).find(".jqg-second-row-header"),d=a.p.groupHeader.length,void 0!==_[0])&&(x=a.p.groupHeader[d-1]),T.columns.length)f=T.columns,c=f[S=0].index||f[0].name;else{if(null!==x)for(var D=0;D<f.length;D++){var q=C.jgrid.inColumnHeader(f[D].name,x.groupHeaders);if(0<=q){f[D].label=x.groupHeaders[q].titleText+"::"+a.p.colNames[D];for(var w=1;w<=x.groupHeaders[q].numberOfColumns-1;w++)f[D+w].label=x.groupHeaders[q].titleText+"::"+a.p.colNames[D+w];D=D+x.groupHeaders[q].numberOfColumns-1}}C.each(f,function(e,t){var r;t.label||(t.label=a.p.colNames[e]),!j&&(r=void 0===t.search||t.search,t.searchoptions&&!0===t.searchoptions.searchhidden&&r||r&&!(!0===t.hidden))&&(j=!0,c=t.index||t.name,S=e),"select"===t.stype&&t.searchoptions&&t.searchoptions.multiple&&(F=!0,O.push(t.index||t.name))})}if((!t&&c||!1===T.multipleSearch)&&(_="eq",0<=S&&f[S].searchoptions&&f[S].searchoptions.sopt?_=f[S].searchoptions.sopt[0]:T.sopt&&T.sopt.length&&(_=T.sopt[0]),t={groupOp:"AND",rules:[{field:c,op:_,data:""}]}),j=!1,T.tmplNames&&T.tmplNames.length&&(j=!0,b=(b="<tr><td class='ui-search-label'>"+T.tmplLabel+"</td>")+"<td><select size='1' name='select_template' class='ui-template "+n.srSelect+"'><option value='default'>Default</option>",C.each(T.tmplNames,function(e,t){b+="<option value='"+e+"'>"+t+"</option>"}),b+="</select></td></tr>"),void 0!==a.p.customFilterDef)for(var I in a.p.customFilterDef)a.p.customFilterDef.hasOwnProperty(I)&&!T.operands.hasOwnProperty(I)&&(T.odata.push({oper:I,text:a.p.customFilterDef[I].text}),T.operands[I]=a.p.customFilterDef[I].operand,!0===a.p.customFilterDef[I].unary)&&e.push(I);d="<table class='EditTable' style='border:0px none;margin-top:5px' id='"+s+"_2'><tbody><tr><td colspan='2'><hr class='"+p.content+"' style='margin:1px'/></td></tr>"+b+"<tr><td class='EditButton' style='text-align:"+h+"'>"+y+"</td><td class='EditButton' "+g+">"+m+"</td></tr></tbody></table>",s=C.jgrid.jqID(s),C("#"+s).jqFilter({columns:f,sortStrategy:T.sortStrategy,filter:T.loadDefaults?t:null,showQuery:T.showQuery,errorcheck:T.errorcheck,sopt:T.sopt,groupButton:T.multipleGroup,ruleButtons:T.multipleSearch,uniqueSearchFields:T.uniqueSearchFields,afterRedraw:T.afterRedraw,ops:T.odata,operands:T.operands,ajaxSelectOptions:a.p.ajaxSelectOptions,groupOps:T.groupOps,addsubgrup:T.addsubgrup,addrule:T.addrule,delgroup:T.delgroup,delrule:T.delrule,autoencode:a.p.autoencode,unaryOperations:e,onChange:function(){this.p.showQuery&&C(".query",this).text(this.toUserFriendlyString()),C.jgrid.isFunction(T.afterChange)&&T.afterChange.call(a,C("#"+s),T)},direction:a.p.direction,id:a.p.id}),u.append(d),C("#"+s+"_2").find("[data-index]").each(function(){var t=parseInt(C(this).attr("data-index"),10);0<=t&&C(this).on("click",function(e){T.buttons[t].click.call(a,C("#"+s),T,e)})}),j&&T.tmplFilters&&T.tmplFilters.length&&C(".ui-template",u).on("change",function(){var e=C(this).val();return"default"===e?C("#"+s).jqFilter("addFilter",t):C("#"+s).jqFilter("addFilter",T.tmplFilters[parseInt(e,10)]),!1}),!0===T.multipleGroup&&(T.multipleSearch=!0),C(a).triggerHandler("jqGridFilterInitialize",[C("#"+s)]),C.jgrid.isFunction(T.onInitializeSearch)&&T.onInitializeSearch.call(a,C("#"+s)),T.gbox="#gbox_"+C.jgrid.jqID(a.p.id);var _=C(".ui-jqgrid").css("font-size")||"11px";T.layer?C.jgrid.createModal(o,u,T,"#gview_"+C.jgrid.jqID(a.p.id),C("#gbox_"+C.jgrid.jqID(a.p.id))[0],"string"==typeof T.layer?"#"+C.jgrid.jqID(T.layer):T.layer,"string"==typeof T.layer?{position:"relative","font-size":_}:{"font-size":_}):C.jgrid.createModal(o,u,T,"#gview_"+C.jgrid.jqID(a.p.id),C("#gbox_"+C.jgrid.jqID(a.p.id))[0],null,{"font-size":_}),(T.searchOnEnter||T.closeOnEscape)&&C("#"+C.jgrid.jqID(o.themodal)).keydown(function(e){var t=C(e.target);return!T.searchOnEnter||13!==e.which||t.hasClass("add-group")||t.hasClass("add-rule")||t.hasClass("delete-group")||t.hasClass("delete-rule")||t.hasClass("fm-button")&&t.is("[id$=_query]")?T.closeOnEscape&&27===e.which?(C("#"+C.jgrid.jqID(o.modalhead)).find(".ui-jqdialog-titlebar-close").click(),!1):void 0:(e.preventDefault(),C("#"+s+"_search").click(),!1)}),v&&C("#"+s+"_query").on("click",function(){return C(".queryresult",u).toggle(),!1}),void 0===T.stringResult&&(T.stringResult=T.multipleSearch),C("#"+s+"_search").on("click",function(){var e,t={};return(r=C("#"+s)).find(".input-elm:focus").change(),F&&T.multipleSearch?(a.p._savedFilter={},e=C.jgrid.filterRefactor({ruleGroup:C.extend(!0,{},r.jqFilter("filterData")),ssfield:O,splitSelect:T.splitSelect,groupOpSelect:T.groupOpSelect}),a.p._savedFilter=C.extend(!0,{},r.jqFilter("filterData"))):e=r.jqFilter("filterData"),T.errorcheck&&(r[0].hideError(),T.showQuery||r.jqFilter("toSQLString"),r[0].p.error)?r[0].showError():(T.stringResult?(t[T.sFilter]=JSON.stringify(e),C.each([T.sField,T.sValue,T.sOper],function(){t[this]=""})):T.multipleSearch?(t[T.sFilter]=e,C.each([T.sField,T.sValue,T.sOper],function(){t[this]=""})):(t[T.sField]=e.rules[0].field,t[T.sValue]=e.rules[0].data,t[T.sOper]=e.rules[0].op,t[T.sFilter]=""),"string"!=typeof t[T.sFilter]&&(t[T.sFilter]=JSON.stringify(t[T.sFilter])),(a.p.search=!0)===a.p.mergeSearch&&a.p.searchModules.hasOwnProperty("searchGrid")&&!1!==a.p.searchModules.searchGrid&&T.multipleSearch?(""!==t[T.sFilter]?a.p.searchModules.searchGrid=t[T.sFilter]:a.p.searchModules.searchGrid=null,C.extend(a.p.postData,{filters:C.jgrid.splitSearch(a.p.searchModules)})):C.extend(a.p.postData,t),!1!==(l=(l=void 0===(l=C(a).triggerHandler("jqGridFilterSearch"))?!0:l)&&C.jgrid.isFunction(T.onSearch)?T.onSearch.call(a,a.p.filters):l)&&C(a).trigger("reloadGrid",[{page:1}]),T.closeAfterSearch&&C.jgrid.hideModal("#"+C.jgrid.jqID(o.themodal),{gb:"#gbox_"+C.jgrid.jqID(a.p.id),jqm:T.jqModal,onClose:T.onClose})),!1}),C("#"+s+"_reset").on("click",function(){var e={},t=C("#"+s);return a.p.search=!1,!(a.p.resetsearch=!0)===T.multipleSearch?e[T.sField]=e[T.sValue]=e[T.sOper]="":e[T.sFilter]="",t[0].resetFilter(),j&&C(".ui-template",u).val("default"),!0===a.p.mergeSearch&&a.p.searchModules.hasOwnProperty("searchGrid")&&!1!==a.p.searchModules.searchGrid?(a.p.searchModules.searchGrid=null,C.extend(a.p.postData,{filters:C.jgrid.splitSearch(a.p.searchModules)}),a.p.search=!0):C.extend(a.p.postData,e),!1!==(l=(l=void 0===(l=C(a).triggerHandler("jqGridFilterReset"))?!0:l)&&C.jgrid.isFunction(T.onReset)?T.onReset.call(a):l)&&C(a).trigger("reloadGrid",[{page:1}]),T.closeAfterReset&&C.jgrid.hideModal("#"+C.jgrid.jqID(o.themodal),{gb:"#gbox_"+C.jgrid.jqID(a.p.id),jqm:T.jqModal,onClose:T.onClose}),!1}),G(C("#"+s)),C(".fm-button:not(."+p.disabled+")",u).hover(function(){C(this).addClass(p.hover)},function(){C(this).removeClass(p.hover)})}}function G(e){(i=(i=void 0===(i=C(a).triggerHandler("jqGridFilterBeforeShow",[e]))?!0:i)&&C.jgrid.isFunction(T.beforeShowSearch)?T.beforeShowSearch.call(a,e):i)&&(C.jgrid.viewModal("#"+C.jgrid.jqID(o.themodal),{gbox:"#gbox_"+C.jgrid.jqID(a.p.id),jqm:T.jqModal,modal:T.modal,overlay:T.overlay,toTop:T.toTop}),C(a).triggerHandler("jqGridFilterAfterShow",[e]),C.jgrid.isFunction(T.afterShowSearch))&&T.afterShowSearch.call(a,e)}})},filterInput:function(l,o){return o=C.extend(!0,{defaultSearch:"cn",groupOp:"OR",searchAll:!1,beforeSearch:null,afterSearch:null,selectFirstFound:!1,firstFoundTimeout:30},o||{}),this.each(function(){var e,t,r,a,s,i=this;i.grid&&(t='{"groupOp":"'+o.groupOp+'","rules":[',r=0,l+="",C.each(i.p.colModel,function(){e=this.index||this.name,a=this.searchoptions||{},a=o.defaultSearch||(a.sopt?a.sopt[0]:o.defaultSearch),(void 0===this.search||this.search||o.searchAll)&&""!==l&&(0<r&&(t+=","),t=(t=t+'{"field":"'+e+'","op":"'+a+'",')+'"data":"'+l.replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"}',r++)}),t+="]}",!0===i.p.mergeSearch&&i.p.searchModules.hasOwnProperty("filterInput")&&!1!==i.p.searchModules.filterInput?(i.p.searchModules.filterInput=0<r?t:null,C.extend(i.p.postData,{filters:C.jgrid.splitSearch(i.p.searchModules)})):C.extend(i.p.postData,{filters:t}),C.each(["searchField","searchString","searchOper"],function(e,t){i.p.postData.hasOwnProperty(t)&&delete i.p.postData[t]}),(s=!(s="stop"===C(i).triggerHandler("jqGridFilterInputBeforeSearch"))&&C.jgrid.isFunction(o.beforeSearch)?o.beforeSearch.call(i):s)||C(i).jqGrid("setGridParam",{search:!0}).trigger("reloadGrid",[{page:1}]),o.selectFirstFound&&setTimeout(function(){var e=C(i).jqGrid("getGridRowByIndex",1);C(i).jqGrid("setSelection",e.id,!1)},o.firstFoundTimeout),C(i).triggerHandler("jqGridFilterInputAfterSearch"),C.jgrid.isFunction(o.afterSearch))&&o.afterSearch.call(i)})},autoSelect:function(n){return n=C.extend(!0,{field:"",direction:"asc",src_date:"Y-m-d",allValues:"All",count_item:!0,create_value:!0},n||{}),this.each(function(){var e=this,t="";if(n.field&&e.p.data&&Array.isArray(e.p.data)){var r,a,s,i,l,o=[];try{(s=C.jgrid.from(e.p.data)).orderBy([n.field],[{so:n.direction,stype:"text",srcfmt:"Y-m-d",sfunc:null}]),i=C.jgrid.jLinq().util.group(s.select(),n.field,!1)}catch(e){}for(l in n.allValues&&(t="<option value=''>"+n.allValues+"</option>",o.push(":"+n.allValues)),i)Object.hasOwn(i,l)&&(r=C("#gsh_"+e.p.id+"_"+n.field).find("td.ui-search-input > select"),a=n.count_item?" ("+i[l].length+")":"",t+="<option value='"+l+"'>"+l+a+"</option>",o.push(l+":"+l+a));r.append(t),r.on("change",function(){e.triggerToolbar()}),n.create_value&&(s=C.jgrid.getElemByAttrVal(e.p.colModel,"name",n.field,!1),C.isEmptyObject(s)||(s.searchoptions?C.extend(s.searchoptions,{value:o.join(";")}):(s.searchoptions={},s.searchoptions.value=o.join(";"))))}})}})});