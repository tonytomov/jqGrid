(r=>{"function"==typeof define&&define.amd?define(["jquery","./grid.base"],r):r(jQuery)})(function(D){D.jgrid.extend({groupingInit:function(){return this.each(function(){D.extend(this.p.groupingView,{groupField:[],groupOrder:[],groupText:[],groupColumnShow:[],groupSummary:[],showSummaryOnHide:!1,sortitems:[],sortnames:[],summary:[],summaryval:[],plusicon:"",minusicon:"",displayField:[],groupSummaryPos:[],formatDisplayField:[],prepareGroupField:null,groupRowNumbers:!1,_locgr:!1},!0)})},groupingSetup:function(){return this.each(function(){var r,e,i,t=this,o=t.p.colModel,n=t.p.groupingView,s=D.jgrid.styleUI[t.p.styleUI||"jQueryUI"].grouping;if(null===n||"object"!=typeof n&&!D.jgrid.isFunction(n))t.p.grouping=!1;else if(n.plusicon||(n.plusicon=s.icon_plus),n.minusicon||(n.minusicon=s.icon_minus),n.groupField.length){for(void 0===n.visibiltyOnNextGrouping&&(n.visibiltyOnNextGrouping=[]),n.lastvalues=[],n._locgr||(n.groups=[]),n.counters=[],r=0;r<n.groupField.length;r++){n.groupOrder[r]||(n.groupOrder[r]="asc"),n.groupText[r]||(n.groupText[r]="{0}"),"boolean"!=typeof n.groupColumnShow[r]&&(n.groupColumnShow[r]=!0),"boolean"!=typeof n.groupSummary[r]&&(n.groupSummary[r]=!1),n.groupSummaryPos[r]||(n.groupSummaryPos[r]="footer");var a=D.jgrid.getElemByAttrVal(t.p.colModel,"name",n.groupField[r],!1).hidden;!0===n.groupColumnShow[r]?(n.visibiltyOnNextGrouping[r]=!0,a&&D(t).jqGrid("showCol",n.groupField[r])):(n.visibiltyOnNextGrouping[r]=D("#"+D.jgrid.jqID(t.p.id+"_"+n.groupField[r])).is(":visible"),a||D(t).jqGrid("hideCol",n.groupField[r]))}for(n.summary=[],n.hideFirstGroupCol&&Array.isArray(n.formatDisplayField)&&!D.jgrid.isFunction(n.formatDisplayField[0])&&(n.formatDisplayField[0]=function(r){return r}),e=0,i=o.length;e<i;e++)n.hideFirstGroupCol&&!o[e].hidden&&n.groupField[0]===o[e].name&&(o[e].formatter=function(){return""}),o[e].summaryType&&(o[e].summaryDivider?n.summary.push({nm:o[e].name,st:o[e].summaryType,v:"",sd:o[e].summaryDivider,vd:"",sr:o[e].summaryRound,srt:o[e].summaryRoundType||"round"}):n.summary.push({nm:o[e].name,st:o[e].summaryType,v:"",sr:o[e].summaryRound,srt:o[e].summaryRoundType||"round"}))}else t.p.grouping=!1})},groupingPrepare:function(u,p){return this.each(function(){for(var r,e,i,t=this.p.groupingView,o=this,n=function(){D.jgrid.isFunction(this.st)?this.v=this.st.call(o,this.v,this.nm,u):(this.v=D(o).jqGrid("groupingCalculations.handler",this.st,this.v,this.nm,this.sr,this.srt,u),"avg"===this.st.toLowerCase()&&this.sd&&(this.vd=D(o).jqGrid("groupingCalculations.handler",this.st,this.vd,this.sd,this.sr,this.srt,u)))},s=t.groupField.length,a=D.jgrid.isFunction(t.prepareGroupField),d=0,l=0;l<s;l++)r=t.groupField[l],i=t.displayField[l],e=u[r],i=null==i?null:u[i],a&&(e=t.prepareGroupField(e,r,u)),null==i&&(i=e),void 0!==e&&(0===p?(t.groups.push({idx:l,dataIndex:r,value:e,displayValue:i,startRow:p,cnt:1,summary:[]}),t.lastvalues[l]=e,t.counters[l]={cnt:1,pos:t.groups.length-1,summary:D.extend(!0,[],t.summary)}):"object"==typeof e||(Array.isArray(t.isInTheSameGroup)&&D.jgrid.isFunction(t.isInTheSameGroup[l])?t.isInTheSameGroup[l].call(o,t.lastvalues[l],e,l,t):t.lastvalues[l]===e)?1===d?(t.groups.push({idx:l,dataIndex:r,value:e,displayValue:i,startRow:p,cnt:1,summary:[]}),t.lastvalues[l]=e,t.counters[l]={cnt:1,pos:t.groups.length-1,summary:D.extend(!0,[],t.summary)}):(t.counters[l].cnt+=1,t.groups[t.counters[l].pos].cnt=t.counters[l].cnt):(t.groups.push({idx:l,dataIndex:r,value:e,displayValue:i,startRow:p,cnt:1,summary:[]}),t.lastvalues[l]=e,t.counters[l]={cnt:d=1,pos:t.groups.length-1,summary:D.extend(!0,[],t.summary)}),D.each(t.counters[l].summary,n),t.groups[t.counters[l].pos].summary=t.counters[l].summary)}),this},groupingToggle:function(c){return this.each(function(){function r(r){return 0<(r=D.map(r.split(" "),function(r){if(r.substring(0,d.length+1)===d+"_")return parseInt(r.substring(d.length+1),10)})).length?r[0]:void 0}var e,i,t,o=this,n=o.p.groupingView,s=c.split("_"),a=parseInt(s[s.length-2],10),d=(s.splice(s.length-2,2),s.join("_")),l=n.minusicon,u=n.plusicon,s=D("#"+D.jgrid.jqID(c)),p=s.length?s[0].nextSibling:null,s=D("#"+D.jgrid.jqID(c)+" span.tree-wrap-"+o.p.direction),g=!1,h=!1;if(s.hasClass(l)){if(p)for(;p&&!(void 0!==(e=r(p.className))&&e<=a);)t=parseInt(D(p).attr("jqfootlevel"),10),(h=!isNaN(t)&&n.showSummaryOnHide&&t<=a)||D(p).hide(),p=p.nextSibling;s.removeClass(l).addClass(u),g=!0}else{if(p)for(i=void 0;p;){if(e=r(p.className),t=parseInt(D(p).attr("jqfootlevel"),10),void 0===i&&(i=void 0===e),h=D(p).hasClass("ui-subgrid")&&D(p).hasClass("ui-sg-collapsed"),void 0!==e){if(e<=a)break;e!==a+1||h||D(p).show().find(">td>span.tree-wrap-"+o.p.direction).removeClass(l).addClass(u)}else i?h||D(p).show():!isNaN(t)&&0<=t&&t===a&&D(p).show();p=p.nextSibling}s.removeClass(u).addClass(l)}D(o).triggerHandler("jqGridGroupingClickGroup",[c,g]),D.jgrid.isFunction(o.p.onClickGroup)&&o.p.onClickGroup.call(o,c,g)}),!1},groupingRender:function(I,N,T,O){return this.each(function(){var h,c,m,f,y=this,v=y.p.groupingView,j=y.p.rownumbers&&v.groupRowNumbers,w="",x=v.groupCollapse?v.plusicon:v.minusicon,q=[],C=v.groupField.length,b=D.jgrid.styleUI[y.p.styleUI||"jQueryUI"].common,x=x+" tree-wrap-"+y.p.direction,G=(D.each(y.p.colModel,function(r,e){for(var i=0;i<C;i++)if(v.groupField[i]===e.name){q[i]=r;break}}),0);function F(r,e,i,t,o){for(var n,s,a,d=((r,e,i)=>{var t,o=!1;if(0===e)o=i[r];else{var n=i[r].idx;if(0===n)o=i[r];else for(t=r;0<=t;t--)if(i[t].idx===n-e){o=i[t];break}}return o})(r,e,i),l=y.p.colModel,u="",p=!1,g=t;g<N;g++)!l[g].hidden&&!p&&o?(s=o,p=!0):s='<td role="gridcell" '+y.formatCol(g,1,"")+">&#160;</td>",D.each(d.summary,function(){if(this.nm===l[g].name){a=l[g].summaryTpl||"{0}",n=this.v;try{this.groupCount=d.cnt,this.groupIndex=d.dataIndex,this.groupValue=d.value}catch(r){}return s='<td role="gridcell" '+y.formatCol(g,1,"")+">"+D.jgrid.template(a,n,d.cnt,d.dataIndex,d.displayValue,d.summary)+"</td>",!1}}),u+=s;return u}var S,H=D.makeArray(v.groupSummary);H.reverse(),S=y.p.multiselect||y.p.rownumbers?' colspan="2"':"",y.p.multiselect&&y.p.rownumbers&&(S=' colspan="3"'),D.each(v.groups,function(e,i){if(v._locgr&&!(i.startRow+i.cnt>(T-1)*O&&i.startRow<T*O))return!0;G++,m=y.p.id+"ghead_"+i.idx,c=m+"_"+e,h="<span style='cursor:pointer;margin-right:8px;margin-left:5px;' class='"+b.icon_base+" "+x+"' onclick=\"jQuery('#"+D.jgrid.jqID(y.p.id)+"').jqGrid('groupingToggle','"+c+"');return false;\"></span>";try{f=Array.isArray(v.formatDisplayField)&&D.jgrid.isFunction(v.formatDisplayField[i.idx])?v.formatDisplayField[i.idx].call(y,i.displayValue,i.value,y.p.colModel[q[i.idx]],i.idx,v):y.formatter(c,i.displayValue,q[i.idx],i.value)}catch(r){f=i.displayValue}for(var t="",o=0;o<i.summary.length;o++){var r=i.summary[o],n=D.jgrid.getElemByAttrVal(y.p.colModel,"name",r.nm,!0);if(0<=n){"string"==typeof r.st&&"avg"===r.st.toLowerCase()&&(r.sd&&r.vd?r.v=r.v/r.vd:r.v&&0<i.cnt&&(r.v=r.v/i.cnt)),r.uv=r.v;try{r.v=y.formatter("",r.v,n,this)}catch(r){}}}if("string"!=typeof(t=D.jgrid.isFunction(v.groupText[i.idx])?v.groupText[i.idx].call(y,f,i.cnt,i.summary):D.jgrid.template.call(y,v.groupText[i.idx],f,i.cnt,i.summary))&&"number"!=typeof t&&(t=f),"header"===v.groupSummaryPos[i.idx]?w=(w+='<tr id="'+c+'"'+(v.groupCollapse&&0<i.idx?' style="display:none;" ':" ")+'role="row" class= "'+b.content+" jqgroup ui-row-"+y.p.direction+" "+m+'">')+F(e,0,v.groups,""===S?0:1,'<td role="gridcell" style="padding-left:'+12*i.idx+'px;"'+S+" "+y.formatCol(0,1,"")+">"+h+t+"</td>")+"</tr>":w+='<tr id="'+c+'"'+(v.groupCollapse&&0<i.idx?' style="display:none;" ':" ")+'role="row" class= "'+b.content+" jqgroup ui-row-"+y.p.direction+" "+m+'"><td class="for-sticky" style="padding-left:'+12*i.idx+'px;">'+h+t+'</td><td colspan="'+(!1===v.groupColumnShow[i.idx]?N-2:N-1)+'"></td></tr>',C-1===i.idx){var s,a,d,l,u=v.groups[e+1],p=0,t=i.startRow,g=void 0!==u?u.startRow:v.groups[e].startRow+v.groups[e].cnt;let r=0;for(o=t=v._locgr&&(p=(T-1)*O)>i.startRow?p:t;o<g&&I[o-p];o++)j&&(a=D(I[o-p][1])).attr("aria-describedby")===y.id+"_rn"&&(r++,a.attr("title",r+"").text(r+""),I[o-p][1]=a.prop("outerHTML")),w+=I[o-p].join("");if("header"!==v.groupSummaryPos[i.idx]){if(void 0!==u){for(d=0;d<v.groupField.length&&u.dataIndex!==v.groupField[d];d++);G=v.groupField.length-d}for(s=0;s<G;s++)H[s]&&(l="",v.groupCollapse&&!v.showSummaryOnHide&&(l=' style="display:none;"'),w=(w+="<tr"+l+' jqfootlevel="'+(i.idx-s)+'" role="row" class="'+b.content+" jqfoot ui-row-"+y.p.direction+'">')+F(e,s,v.groups,0,!1)+"</tr>");G=d}}}),D("#"+D.jgrid.jqID(y.p.id)+" tbody").first().append(w),w=null})},groupingGroupBy:function(t,o){return this.each(function(){var r,e=this,i=("string"==typeof t&&(t=[t]),e.p.groupingView);for(e.p.grouping=!0,i._locgr=!1,void 0===i.visibiltyOnNextGrouping&&(i.visibiltyOnNextGrouping=[]),r=0;r<i.groupField.length;r++)!i.groupColumnShow[r]&&i.visibiltyOnNextGrouping[r]&&D(e).jqGrid("showCol",i.groupField[r]);for(r=0;r<t.length;r++)i.visibiltyOnNextGrouping[r]=D("#"+D.jgrid.jqID(e.p.id)+"_"+D.jgrid.jqID(t[r])).is(":visible");e.p.groupingView=D.extend(e.p.groupingView,o||{}),i.groupField=t,D(e).trigger("reloadGrid")})},groupingRemove:function(t,o){return this.each(function(){var r=this;if(void 0===t&&(t=!0),void 0===o&&(o=!1),!(r.p.grouping=!1)===t){for(var e=r.p.groupingView,i=0;i<e.groupField.length;i++)!e.groupColumnShow[i]&&e.visibiltyOnNextGrouping[i]&&D(r).jqGrid("showCol",e.groupField);D("#"+D.jgrid.jqID(r.p.id)+" tbody").first().find("tr.jqgroup, tr.jqfoot").remove(),D("#"+D.jgrid.jqID(r.p.id)+" tbody").first().find("tr.jqgrow:hidden").show()}else D(r).trigger("reloadGrid");o&&D(r).jqGrid("groupingInit")})},groupingCalculations:{handler:function(r,e,i,t,o,n){var s,a={sum:function(){return D.jgrid.floatNum(e)+D.jgrid.floatNum(n[i])},min:function(){return""===e?D.jgrid.floatNum(n[i]):Math.min(D.jgrid.floatNum(e),D.jgrid.floatNum(n[i]))},max:function(){return""===e?D.jgrid.floatNum(n[i]):Math.max(D.jgrid.floatNum(e),D.jgrid.floatNum(n[i]))},count:function(){return""===e&&(e=0),n.hasOwnProperty(i)?e+1:0},avg:function(){return a.sum()}};if(a[r])return s=a[r](),null!=t?"fixed"===o?s.toFixed(t):(o=Math.pow(10,t),Math.round(s*o)/o):s;throw"jqGrid Grouping No such method: "+r}},groupingResetCalcs:function(){return this.each(function(){this.p.groupingView._locgr=!1})},setColSpanHeader:function(C){return this.each(function(){var r,e,i,t,o,n,s,a,d,l,u,p,g,h,c=this,m=0,f=c.p.colModel,y=f.length,v=c.grid.headers,j=D("table.ui-jqgrid-htable",c.grid.hDiv),w=j.children("thead"),x=j.find(".jqg-first-row-header"),j=!1,q=w.children("tr").length;for(Array.isArray(C)&&(c.p.colSpanHeader=C),void 0===x[0]?x=D("<tr>",{role:"row","aria-hidden":"true"}).addClass("jqg-first-row-header").css("height","auto"):x.empty(),c.p.frozenColumns&&(D(c).jqGrid("destroyFrozenColumns"),j=!0),r=0;r<y;r++)i=v[r].el,t=D(i),e=f[r],o={height:"0px",width:v[r].width+"px",display:e.hidden?"none":""},D("<th>",{role:"gridcell"}).css(o).addClass("ui-first-th-"+c.p.direction+" "+(e.labelClasses||"")).appendTo(x);for(w.prepend(x),D(c).on("jqGridResizeStop.setGroupHeaders",function(r,e,i){x.find("th").eq(i)[0].style.width=e+"px"}),r=0;r<y;r++)if(i=v[r].el,t=D(i),e=f[r],0<=(s=D.jgrid.inColumnHeader(e.name,c.p.colSpanHeader))){for(d=(a=c.p.colSpanHeader[s]).numberOfColumns,l=a.titleText||"",g=a.className||"",u=a.toolTip||"",s=p=0;s<d&&r+s<y;s++)f[r+s].hidden||p++;if(0<p&&(t.attr("colspan",String(p)),1<q))for(n=1;n<q;n++)D("tr",w).eq(n+1).find("th").eq(r).attr("colspan",String(p));for(l&&(h=t.find("div.ui-th-div")[0],a.savedLabel=h.innerHTML,h.innerHTML=l,"string"==typeof u&&""!==u?t.attr("title",u):c.p.headertitles&&t.attr("title",l)),t.addClass(g),m=0;m<d-1;m++)if(D(v[m+r+1].el).hide(),c.p.colModel[m+r+1].hidedlg=!0,c.p.colModel[m+r+1]._colspancell=!0,1<q)for(n=1;n<q;n++)D("tr",w).eq(n+1).find("th").eq(r+m+1).hide()}j&&D(c).jqGrid("setFrozenColumns")})},destroyColSpanHeader:function(a){return void 0===a&&(a=!0),this.each(function(){var i,t,r,o,n,e=this,s=D("table.ui-jqgrid-htable",e.grid.hDiv).children("thead");if(D("tr.jqg-first-row-header",s).remove(),e.p.colSpanHeader.length)for(r=0;r<e.p.colSpanHeader.length;r++)if(i=e.p.colSpanHeader[r],!((n=D.jgrid.getElemByAttrVal(e.p.colModel,"name",i.startColumnName,!0))<0)){for(t=n+1;t<n+i.numberOfColumns;t++)e.p.colModel[t].hidedlg=!1,e.p.colModel[t]._colspancell=!1;D(">tr",s).each(function(r,e){for((o=D("th",e).eq(n)).className||(o.className=""),D(o).attr("colspan","").removeClass(o.className),D(e).hasClass("ui-jqgrid-labels")&&(o.find("div.ui-th-div")[0].innerHTML=i.savedLabel),t=1;t<i.numberOfColumns;t++)D("th",e).eq(n+t).show()})}a&&(e.p.colSpanHeader=[])})},setGroupHeaders:function(b){return b=D.extend({useColSpanStyle:!1,groupHeaders:[]},b||{}),this.each(function(){var r,e,i,t,o,n,s,a,d,l,u,p,g=this,h=0,c=g.p.colModel,m=c.length,f=g.grid.headers,y=D("table.ui-jqgrid-htable",g.grid.hDiv),v=y.children("thead").children("tr.ui-jqgrid-labels").last().addClass("jqg-second-row-header"),j=y.children("thead"),w=y.find(".jqg-first-row-header"),x=!1,q=!1,C=D.jgrid.styleUI[g.p.styleUI||"jQueryUI"].base;for(g.p.groupHeader||(g.p.groupHeader=[]),g.p.groupHeader.push(b),g.p.groupHeaderOn=!0,void 0===w[0]?w=D("<tr>",{role:"row","aria-hidden":"true"}).addClass("jqg-first-row-header").css("height","auto"):w.empty(),g.p.frozenColumns&&(D(g).jqGrid("destroyFrozenColumns"),q=!0),(D(document.activeElement).is("input")||D(document.activeElement).is("textarea"))&&(x=document.activeElement),D(g).prepend(j),i=D("<tr>",{role:"row"}).addClass("ui-jqgrid-labels jqg-third-row-header"),r=0;r<m;r++)if(t=f[r].el,o=D(t),e=c[r],l={height:"0px",width:f[r].width+"px",display:e.hidden?"none":""},D("<th>",{role:"gridcell"}).css(l).addClass("ui-first-th-"+g.p.direction+" "+(e.labelClasses||"")).appendTo(w),t.style.width="",0<=(n=D.jgrid.inColumnHeader(e.name,b.groupHeaders))){for(s=(l=b.groupHeaders[n]).numberOfColumns,p=l.titleText,a=l.toolTip||"",l=l.className||"",n=d=0;n<s&&r+n<m;n++)c[r+n].hidden||d++;l=D("<th>").attr({role:"columnheader","data-spname":e.name}).addClass(C.headerBox+" ui-th-column-header ui-th-"+g.p.direction+" "+l+" "+(e.labelClasses||"")).html(p),0<d&&l.attr("colspan",String(d)),"string"==typeof a&&""!==a?l.attr("title",a):g.p.headertitles&&l.attr("title",l.text()),0===d&&l.hide(),o.before(l),i.append(t),h=s-1}else 0===h?b.useColSpanStyle?(p=o.attr("rowspan")?parseInt(o.attr("rowspan"),10)+1:2,o.attr("rowspan",p)):(D("<th>",{role:"columnheader"}).addClass(C.headerBox+" ui-th-column-header ui-th-"+g.p.direction).css({display:e.hidden?"none":""}).attr({"data-spname":e.name}).insertBefore(o),i.append(t)):(i.append(t),h--);if((j=D(g).children("thead")).prepend(w),i.insertAfter(v),y.append(j),b.useColSpanStyle&&(y.find("span.ui-jqgrid-resize").each(function(){var r=D(this).parent();r.is(":visible")&&(this.style.cssText="height: "+r.height()+"px !important; cursor: col-resize;")}),y.find("div.ui-jqgrid-sortable").each(function(){var r=D(this),e=r.parent();e.is(":visible")&&e.is(":has(span.ui-jqgrid-resize)")&&r.css("top",(e.height()-r.outerHeight())/2-4+"px")})),u=j.find("tr.jqg-first-row-header"),D(g).on("jqGridResizeStop.setGroupHeaders",function(r,e,i){u.find("th").eq(i)[0].style.width=e+"px"}),x)try{D(x).focus()}catch(r){}v=D("tr.jqg-second-row-header th").eq(0);"object"===D.jgrid.type(v)&&v.length&&""===D.jgrid.trim(v[0].outerText)&&D("tr.jqg-second-row-header th").eq(0).prepend("&nbsp;"),q&&D(g).jqGrid("setFrozenColumns"),D(g).triggerHandler("afterSetGroupHandler",[b])})},destroyGroupHeader:function(p){return void 0===p&&(p=!0),this.each(function(){var r,e,i,t,o,n,s=this,a=s.grid,d=D("table.ui-jqgrid-htable thead",a.hDiv),l=s.p.colModel,u=!1;if(a){for(s.p.frozenColumns&&(D(s).jqGrid("destroyFrozenColumns"),u=!0),D(this).off(".setGroupHeaders"),s.p.groupHeaderOn=!1,r=D("<tr>",{role:"row"}).addClass("ui-jqgrid-labels"),e=0,i=(t=a.headers).length;e<i;e++){n=l[e].hidden?"none":"",n=D(t[e].el).width(D("tr.jqg-first-row-header th",d).eq(e).width()).css("display",n);try{n.removeAttr("rowSpan")}catch(r){n.attr("rowSpan",1)}r.append(n),0<(o=n.children("span.ui-jqgrid-resize")).length&&(o[0].style.height=""),n.children("div")[0].style.top=""}D(d).children("tr.ui-jqgrid-labels").remove(),D(d).children("tr.jqg-first-row-header").remove(),D(d).prepend(r),!0===p&&D(s).jqGrid("setGridParam",{groupHeader:null}),u&&D(s).jqGrid("setFrozenColumns"),D(s).off("afterSetGroupHandler")}})},isGroupHeaderOn:function(){var r=this[0];return!0===r.p.groupHeaderOn&&r.p.groupHeader&&(Array.isArray(r.p.groupHeader)||D.jgrid.isFunction(r.p.groupHeader))},refreshGroupHeaders:function(){return this.each(function(){var r,e=this,i=D(e).jqGrid("isGroupHeaderOn");if(i&&(D(e).jqGrid("destroyGroupHeader",!1),r=D.extend([],e.p.groupHeader),e.p.groupHeader=null),i&&r)for(var t=0;t<r.length;t++)D(e).jqGrid("setGroupHeaders",r[t])})}})});