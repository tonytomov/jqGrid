/**
*
* @license Guriddo jqGrid JS - v5.2.1 
* Copyright(c) 2008, Tony Tomov, tony@trirand.com
* 
* License: http://guriddo.net/?page_id=103334
*/
!function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery","./grid.base"],a):a(jQuery)}(function(a){"use strict";a.jgrid.extend({editCell:function(b,c,d){return this.each(function(){var e,f,g,h,i=this,j=a(this).jqGrid("getStyleUI",i.p.styleUI+".common","highlight",!0),k=a(this).jqGrid("getStyleUI",i.p.styleUI+".common","hover",!0),l=a(this).jqGrid("getStyleUI",i.p.styleUI+".celledit","inputClass",!0);if(i.grid&&!0===i.p.cellEdit){if(c=parseInt(c,10),i.p.selrow=i.rows[b].id,i.p.knv||a(i).jqGrid("GridNav"),i.p.savedRow.length>0){if(!0===d&&b==i.p.iRow&&c==i.p.iCol)return;a(i).jqGrid("saveCell",i.p.savedRow[0].id,i.p.savedRow[0].ic)}else window.setTimeout(function(){a("#"+a.jgrid.jqID(i.p.knv)).attr("tabindex","-1").focus()},1);if(h=i.p.colModel[c],"subgrid"!==(e=h.name)&&"cb"!==e&&"rn"!==e){try{g=a(i.rows[b].cells[c])}catch(d){g=a("td:eq("+c+")",i.rows[b])}if(parseInt(i.p.iCol,10)>=0&&parseInt(i.p.iRow,10)>=0&&void 0!==i.p.iRowId){var m=a(i).jqGrid("getGridRowById",i.p.iRowId);a(m).removeClass("selected-row "+k).find("td:eq("+i.p.iCol+")").removeClass("edit-cell "+j)}if(g.addClass("edit-cell "+j),a(i.rows[b]).addClass("selected-row "+k),!0!==h.editable||!0!==d||g.hasClass("not-editable-cell")||a.isFunction(i.p.isCellEditable)&&!i.p.isCellEditable.call(i,e,b,c))f=g.html().replace(/\&#160\;/gi,""),a(i).triggerHandler("jqGridSelectCell",[i.rows[b].id,e,f,b,c]),a.isFunction(i.p.onSelectCell)&&i.p.onSelectCell.call(i,i.rows[b].id,e,f,b,c);else{try{f=a.unformat.call(i,g,{rowId:i.rows[b].id,colModel:h},c)}catch(a){f=h.edittype&&"textarea"===h.edittype?g.text():g.html()}if(i.p.autoencode&&(f=a.jgrid.htmlDecode(f)),h.edittype||(h.edittype="text"),i.p.savedRow.push({id:b,ic:c,name:e,v:f,rowId:i.rows[b].id}),("&nbsp;"===f||"&#160;"===f||1===f.length&&160===f.charCodeAt(0))&&(f=""),a.isFunction(i.p.formatCell)){var n=i.p.formatCell.call(i,i.rows[b].id,e,f,b,c);void 0!==n&&(f=n)}a(i).triggerHandler("jqGridBeforeEditCell",[i.rows[b].id,e,f,b,c]),a.isFunction(i.p.beforeEditCell)&&i.p.beforeEditCell.call(i,i.rows[b].id,e,f,b,c);var o=a.extend({},h.editoptions||{},{id:b+"_"+e,name:e,rowId:i.rows[b].id,oper:"edit"}),p=a.jgrid.createEl.call(i,h.edittype,o,f,!0,a.extend({},a.jgrid.ajaxOptions,i.p.ajaxSelectOptions||{}));a.inArray(h.edittype,["text","textarea","password","select"])>-1&&a(p).addClass(l),g.html("").append(p).attr("tabindex","0"),a.jgrid.bindEv.call(i,p,o),window.setTimeout(function(){a(p).focus()},1),a("input, select, textarea",g).on("keydown",function(d){if(27===d.keyCode&&(a("input.hasDatepicker",g).length>0?a(".ui-datepicker").is(":hidden")?a(i).jqGrid("restoreCell",b,c):a("input.hasDatepicker",g).datepicker("hide"):a(i).jqGrid("restoreCell",b,c)),13===d.keyCode&&!d.shiftKey)return a(i).jqGrid("saveCell",b,c),!1;if(9===d.keyCode){if(i.grid.hDiv.loading)return!1;d.shiftKey?a(i).jqGrid("prevCell",b,c):a(i).jqGrid("nextCell",b,c)}d.stopPropagation()}),a(i).triggerHandler("jqGridAfterEditCell",[i.rows[b].id,e,f,b,c]),a.isFunction(i.p.afterEditCell)&&i.p.afterEditCell.call(i,i.rows[b].id,e,f,b,c)}i.p.iCol=c,i.p.iRow=b,i.p.iRowId=i.rows[b].id}}})},saveCell:function(b,c){return this.each(function(){var d=this,e=d.p.savedRow.length>=1?0:null,f=a.jgrid.getRegional(this,"errors"),g=a.jgrid.getRegional(this,"edit");if(d.grid&&!0===d.p.cellEdit){if(null!==e){var h,i,j=a(d).jqGrid("getGridRowById",d.p.savedRow[0].rowId),k=a("td:eq("+c+")",j),l=d.p.colModel[c],m=l.name,n=a.jgrid.jqID(m),o=a(k).offset();switch(l.edittype){case"select":if(l.editoptions.multiple){var p=a("#"+b+"_"+n,j),q=[];h=a(p).val(),h?h.join(","):h="",a("option:selected",p).each(function(b,c){q[b]=a(c).text()}),i=q.join(",")}else h=a("#"+b+"_"+n+" option:selected",j).val(),i=a("#"+b+"_"+n+" option:selected",j).text();l.formatter&&(i=h);break;case"checkbox":var r=["Yes","No"];l.editoptions&&l.editoptions.value&&(r=l.editoptions.value.split(":")),h=a("#"+b+"_"+n,j).is(":checked")?r[0]:r[1],i=h;break;case"password":case"text":case"textarea":case"button":h=a("#"+b+"_"+n,j).val(),i=h;break;case"custom":try{if(!l.editoptions||!a.isFunction(l.editoptions.custom_value))throw"e1";if(void 0===(h=l.editoptions.custom_value.call(d,a(".customelement",k),"get")))throw"e2";i=h}catch(b){"e1"===b?a.jgrid.info_dialog(f.errcap,"function 'custom_value' "+g.msg.nodefined,g.bClose,{styleUI:d.p.styleUI}):"e2"===b?a.jgrid.info_dialog(f.errcap,"function 'custom_value' "+g.msg.novalue,g.bClose,{styleUI:d.p.styleUI}):a.jgrid.info_dialog(f.errcap,b.message,g.bClose,{styleUI:d.p.styleUI})}}if(i!==d.p.savedRow[e].v){var s=a(d).triggerHandler("jqGridBeforeSaveCell",[d.p.savedRow[e].rowId,m,h,b,c]);if(s&&(h=s,i=s),a.isFunction(d.p.beforeSaveCell)){var t=d.p.beforeSaveCell.call(d,d.p.savedRow[e].rowId,m,h,b,c);t&&(h=t,i=t)}var u=a.jgrid.checkValues.call(d,h,c),v=!1;if(!0===u[0]){var w=a(d).triggerHandler("jqGridBeforeSubmitCell",[d.p.savedRow[e].rowId,m,h,b,c])||{};a.isFunction(d.p.beforeSubmitCell)&&((w=d.p.beforeSubmitCell.call(d,d.p.savedRow[e].rowId,m,h,b,c))||(w={}));var x=a(d).triggerHandler("jqGridOnSubmitCell",[d.p.savedRow[e].rowId,m,h,b,c]);if(void 0===x&&(x=!0),a.isFunction(d.p.onSubmitCell)&&void 0===(x=d.p.onSubmitCell(d.p.savedRow[e].rowId,m,h,b,c))&&(x=!0),!1===x)return;if(a("input.hasDatepicker",k).length>0&&a("input.hasDatepicker",k).datepicker("hide"),"remote"===d.p.cellsubmit)if(d.p.cellurl){var y={};d.p.autoencode&&(h=a.jgrid.htmlEncode(h)),l.editoptions&&l.editoptions.NullIfEmpty&&""===h&&(h="null",v=!0),y[m]=h;var z=d.p.prmNames,A=z.id,B=z.oper;y[A]=a.jgrid.stripPref(d.p.idPrefix,d.p.savedRow[e].rowId),y[B]=z.editoper,y=a.extend(w,y),a(d).jqGrid("progressBar",{method:"show",loadtype:d.p.loadui,htmlcontent:a.jgrid.getRegional(d,"defaults.savetext")}),d.grid.hDiv.loading=!0,a.ajax(a.extend({url:d.p.cellurl,data:a.isFunction(d.p.serializeCellData)?d.p.serializeCellData.call(d,y,m):y,type:"POST",complete:function(l,p){if(a(d).jqGrid("progressBar",{method:"hide",loadtype:d.p.loadui}),d.grid.hDiv.loading=!1,"success"===p){var q=a(d).triggerHandler("jqGridAfterSubmitCell",[d,l,y[A],m,h,b,c])||[!0,""];!0===q[0]&&a.isFunction(d.p.afterSubmitCell)&&(q=d.p.afterSubmitCell.call(d,l,y[A],m,h,b,c)),!0===q[0]?(v&&(h=""),a(k).empty(),a(d).jqGrid("setCell",d.p.savedRow[e].rowId,c,i,!1,!1,!0),a(k).addClass("dirty-cell"),a(j).addClass("edited"),a(d).triggerHandler("jqGridAfterSaveCell",[d.p.savedRow[e].rowId,m,h,b,c]),a.isFunction(d.p.afterSaveCell)&&d.p.afterSaveCell.call(d,d.p.savedRow[e].rowId,m,h,b,c),d.p.savedRow.splice(0,1)):(a(d).triggerHandler("jqGridErrorCell",[l,p]),a.isFunction(d.p.errorCell)?d.p.errorCell.call(d,l,p):a.jgrid.info_dialog(f.errcap,q[1],g.bClose,{styleUI:d.p.styleUI,top:o.top+30,left:o.left,onClose:function(){d.p.restoreCellonFail||a("#"+b+"_"+n,j).focus()}}),d.p.restoreCellonFail&&a(d).jqGrid("restoreCell",b,c))}},error:function(e,h,i){a("#lui_"+a.jgrid.jqID(d.p.id)).hide(),d.grid.hDiv.loading=!1,a(d).triggerHandler("jqGridErrorCell",[e,h,i]),a.isFunction(d.p.errorCell)?d.p.errorCell.call(d,e,h,i):a.jgrid.info_dialog(f.errcap,e.status+" : "+e.statusText+"<br/>"+h,g.bClose,{styleUI:d.p.styleUI,top:o.top+30,left:o.left,onClose:function(){d.p.restoreCellonFail||a("#"+b+"_"+n,j).focus()}}),d.p.restoreCellonFail&&a(d).jqGrid("restoreCell",b,c)}},a.jgrid.ajaxOptions,d.p.ajaxCellOptions||{}))}else try{a.jgrid.info_dialog(f.errcap,f.nourl,g.bClose,{styleUI:d.p.styleUI}),d.p.restoreCellonFail&&a(d).jqGrid("restoreCell",b,c)}catch(a){}"clientArray"===d.p.cellsubmit&&(a(k).empty(),a(d).jqGrid("setCell",d.p.savedRow[e].rowId,c,i,!1,!1,!0),a(k).addClass("dirty-cell"),a(j).addClass("edited"),a(d).triggerHandler("jqGridAfterSaveCell",[d.p.savedRow[e].rowId,m,h,b,c]),a.isFunction(d.p.afterSaveCell)&&d.p.afterSaveCell.call(d,d.p.savedRow[e].rowId,m,h,b,c),d.p.savedRow.splice(0,1))}else try{a.isFunction(d.p.validationCell)?d.p.validationCell.call(d,a("#"+b+"_"+n,j),u[1],b,c):(window.setTimeout(function(){a.jgrid.info_dialog(f.errcap,h+" "+u[1],g.bClose,{styleUI:d.p.styleUI,top:o.top+30,left:o.left,onClose:function(){d.p.restoreCellonFail||a("#"+b+"_"+n,j).focus()}})},50),d.p.restoreCellonFail&&a(d).jqGrid("restoreCell",b,c))}catch(a){alert(u[1])}}else a(d).jqGrid("restoreCell",b,c)}window.setTimeout(function(){a("#"+a.jgrid.jqID(d.p.knv)).attr("tabindex","-1").focus()},0)}})},restoreCell:function(b,c){return this.each(function(){var d=this,e=d.p.savedRow.length>=1?0:null;if(d.grid&&!0===d.p.cellEdit){if(null!==e){var f=a(d).jqGrid("getGridRowById",d.p.savedRow[e].rowId),g=a("td:eq("+c+")",f);if(a.isFunction(a.fn.datepicker))try{a("input.hasDatepicker",g).datepicker("hide")}catch(a){}a(g).empty().attr("tabindex","-1"),a(d).jqGrid("setCell",d.p.savedRow[0].rowId,c,d.p.savedRow[e].v,!1,!1,!0),a(d).triggerHandler("jqGridAfterRestoreCell",[d.p.savedRow[e].rowId,d.p.savedRow[e].v,b,c]),a.isFunction(d.p.afterRestoreCell)&&d.p.afterRestoreCell.call(d,d.p.savedRow[e].rowId,d.p.savedRow[e].v,b,c),d.p.savedRow.splice(0,1)}window.setTimeout(function(){a("#"+d.p.knv).attr("tabindex","-1").focus()},0)}})},nextCell:function(b,c){return this.each(function(){var d,e=this,f=!1;if(e.grid&&!0===e.p.cellEdit){for(d=c+1;d<e.p.colModel.length;d++)if(!0===e.p.colModel[d].editable&&(!a.isFunction(e.p.isCellEditable)||e.p.isCellEditable.call(e,e.p.colModel[d].name,b,d))){f=d;break}!1!==f?a(e).jqGrid("editCell",b,f,!0):e.p.savedRow.length>0&&a(e).jqGrid("saveCell",b,c)}})},prevCell:function(b,c){return this.each(function(){var d,e=this,f=!1;if(e.grid&&!0===e.p.cellEdit){for(d=c-1;d>=0;d--)if(!0===e.p.colModel[d].editable&&(!a.isFunction(e.p.isCellEditable)||e.p.isCellEditable.call(e,e.p.colModel[d].name,b,d))){f=d;break}!1!==f?a(e).jqGrid("editCell",b,f,!0):e.p.savedRow.length>0&&a(e).jqGrid("saveCell",b,c)}})},GridNav:function(){return this.each(function(){function b(b,c,e){if("v"===e.substr(0,1)){var f=a(d.grid.bDiv)[0].clientHeight,g=a(d.grid.bDiv)[0].scrollTop,h=d.rows[b].offsetTop+d.rows[b].clientHeight,i=d.rows[b].offsetTop;"vd"===e&&h>=f&&(a(d.grid.bDiv)[0].scrollTop=a(d.grid.bDiv)[0].scrollTop+d.rows[b].clientHeight),"vu"===e&&i<g&&(a(d.grid.bDiv)[0].scrollTop=a(d.grid.bDiv)[0].scrollTop-d.rows[b].clientHeight)}if("h"===e){var j=a(d.grid.bDiv)[0].clientWidth,k=a(d.grid.bDiv)[0].scrollLeft,l=d.rows[b].cells[c].offsetLeft+d.rows[b].cells[c].clientWidth,m=d.rows[b].cells[c].offsetLeft;l>=j+parseInt(k,10)?a(d.grid.bDiv)[0].scrollLeft=a(d.grid.bDiv)[0].scrollLeft+d.rows[b].cells[c].clientWidth:m<k&&(a(d.grid.bDiv)[0].scrollLeft=a(d.grid.bDiv)[0].scrollLeft-d.rows[b].cells[c].clientWidth)}}function c(a,b){var c,e;if("lft"===b)for(c=a+1,e=a;e>=0;e--)if(!0!==d.p.colModel[e].hidden){c=e;break}if("rgt"===b)for(c=a-1,e=a;e<d.p.colModel.length;e++)if(!0!==d.p.colModel[e].hidden){c=e;break}return c}var d=this;if(d.grid&&!0===d.p.cellEdit){d.p.knv=d.p.id+"_kn";var e,f,g=a("<div style='position:fixed;top:0px;width:1px;height:1px;' tabindex='0'><div tabindex='-1' style='width:1px;height:1px;' id='"+d.p.knv+"'></div></div>");a(g).insertBefore(d.grid.cDiv),a("#"+d.p.knv).focus().keydown(function(g){switch(f=g.keyCode,"rtl"===d.p.direction&&(37===f?f=39:39===f&&(f=37)),f){case 38:d.p.iRow-1>0&&(b(d.p.iRow-1,d.p.iCol,"vu"),a(d).jqGrid("editCell",d.p.iRow-1,d.p.iCol,!1));break;case 40:d.p.iRow+1<=d.rows.length-1&&(b(d.p.iRow+1,d.p.iCol,"vd"),a(d).jqGrid("editCell",d.p.iRow+1,d.p.iCol,!1));break;case 37:d.p.iCol-1>=0&&(e=c(d.p.iCol-1,"lft"),b(d.p.iRow,e,"h"),a(d).jqGrid("editCell",d.p.iRow,e,!1));break;case 39:d.p.iCol+1<=d.p.colModel.length-1&&(e=c(d.p.iCol+1,"rgt"),b(d.p.iRow,e,"h"),a(d).jqGrid("editCell",d.p.iRow,e,!1));break;case 13:parseInt(d.p.iCol,10)>=0&&parseInt(d.p.iRow,10)>=0&&a(d).jqGrid("editCell",d.p.iRow,d.p.iCol,!0);break;default:return!0}return!1})}})},getChangedCells:function(b){var c=[];return b||(b="all"),this.each(function(){var d,e=this;e.grid&&!0===e.p.cellEdit&&a(e.rows).each(function(f){var g={};a(this).hasClass("edited")&&(a("td",this).each(function(c){if("cb"!==(d=e.p.colModel[c].name)&&"subgrid"!==d)if("dirty"===b){if(a(this).hasClass("dirty-cell"))try{g[d]=a.unformat.call(e,this,{rowId:e.rows[f].id,colModel:e.p.colModel[c]},c)}catch(b){g[d]=a.jgrid.htmlDecode(a(this).html())}}else try{g[d]=a.unformat.call(e,this,{rowId:e.rows[f].id,colModel:e.p.colModel[c]},c)}catch(b){g[d]=a.jgrid.htmlDecode(a(this).html())}}),g.id=this.id,c.push(g))})}),c}})});