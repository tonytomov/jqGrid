(function(f){"function"===typeof define&&define.amd?define(["jquery"],f):"object"===typeof exports?f(require("jquery")):f(jQuery)})(function(f){var w=f.jgrid,y=w.getAccessor,C=w.stripPref,A=w.jqID,l=f.fn.jqGrid,u=function(){var b=f.makeArray(arguments);b[0]="treeGrid"+b[0].charAt(0).toUpperCase()+b[0].substring(1);b.unshift("");b.unshift("");b.unshift(this.p);return w.feedback.apply(this,b)};w.extend({setTreeNode:function(){return this.each(function(){var b=f(this),a=this.p;if(this.grid&&a.treeGrid){var c=
a.treeReader.expanded_field,g=a.treeReader.leaf_field;b.unbind("jqGridBeforeSelectRow.setTreeNode");b.bind("jqGridBeforeSelectRow.setTreeNode",function(e,h,d){if(null!=d){e=f(d.target);d=e.closest("tr.jqgrow>td");var k=d.parent(),m=function(d){d=a.data[a._index[C(a.idPrefix,d)]];var e=d[c]?"collapse":"expand";d[g]||(l[e+"Row"].call(b,d,k),l[e+"Node"].call(b,d,k))};e.is("div.treeclick")?m(h):a.ExpandColClick&&0<d.length&&0<e.closest("span.ui-jqgrid-cell-wrapper",d).length&&m(h);return!0}})}})},setTreeGrid:function(){return this.each(function(){var b=
this.p,a,c,g,e=[],h=["leaf_field","expanded_field","loaded"];if(b.treeGrid){b.treedatatype||f.extend(this.p,{treedatatype:b.datatype});b.subGrid=!1;b.altRows=!1;b.pgbuttons=!1;b.pginput=!1;b.gridview=!0;null===b.rowTotal&&(b.rowNum=b.maxRowNum);b.rowList=[];b.treeIcons.plus="rtl"===b.direction?b.treeIcons.plusRtl:b.treeIcons.plusLtr;"nested"===b.treeGridModel?b.treeReader=f.extend({level_field:"level",left_field:"lft",right_field:"rgt",leaf_field:"isLeaf",expanded_field:"expanded",loaded:"loaded",
icon_field:"icon"},b.treeReader):"adjacency"===b.treeGridModel&&(b.treeReader=f.extend({level_field:"level",parent_id_field:"parent",leaf_field:"isLeaf",expanded_field:"expanded",loaded:"loaded",icon_field:"icon"},b.treeReader));for(c in b.colModel)if(b.colModel.hasOwnProperty(c))for(g in a=b.colModel[c].name,b.treeReader)b.treeReader.hasOwnProperty(g)&&b.treeReader[g]===a&&e.push(a);f.each(b.treeReader,function(a){var c=String(this);c&&-1===f.inArray(c,e)&&(0<=f.inArray(a,h)?b.additionalProperties.push({name:c,
convert:function(a){return!0===a||"true"===String(a).toLowerCase()||"1"===String(a)?!0:a}}):b.additionalProperties.push(c))})}})},expandRow:function(b){this.each(function(){var a=f(this),c=this.p;if(this.grid&&c.treeGrid){var g=c.treeReader.expanded_field,e=b[c.localReader.id];if(u.call(this,"beforeExpandRow",{rowid:e,item:b})){var h=l.getNodeChildren.call(a,b);f(h).each(function(){var b=c.idPrefix+y(this,c.localReader.id);f(l.getGridRowById.call(a,b)).css("display","");this[g]&&l.expandRow.call(a,
this)});u.call(this,"afterExpandRow",{rowid:e,item:b})}}})},collapseRow:function(b){this.each(function(){var a=f(this),c=this.p;if(this.grid&&c.treeGrid){var g=c.treeReader.expanded_field,e=b[c.localReader.id];if(u.call(this,"beforeCollapseRow",{rowid:e,item:b})){var h=l.getNodeChildren.call(a,b);f(h).each(function(){var b=c.idPrefix+y(this,c.localReader.id);f(l.getGridRowById.call(a,b)).css("display","none");this[g]&&l.collapseRow.call(a,this)});u.call(this,"afterCollapseRow",{rowid:e,item:b})}}})},
getRootNodes:function(){var b=[];this.each(function(){var a=this.p;if(this.grid&&a.treeGrid)switch(a.treeGridModel){case "nested":var c=a.treeReader.level_field;f(a.data).each(function(){parseInt(this[c],10)===parseInt(a.tree_root_level,10)&&b.push(this)});break;case "adjacency":var g=a.treeReader.parent_id_field;f(a.data).each(function(){null!==this[g]&&"null"!==String(this[g]).toLowerCase()||b.push(this)})}});return b},getNodeDepth:function(b){var a=null;this.each(function(){var c=this.p;if(this.grid&&
c.treeGrid)switch(c.treeGridModel){case "nested":a=parseInt(b[c.treeReader.level_field],10)-parseInt(c.tree_root_level,10);break;case "adjacency":a=l.getNodeAncestors.call(f(this),b).length}});return a},getNodeParent:function(b){var a=this[0];if(!a||!a.grid||null==a.p||!a.p.treeGrid||null==b)return null;var a=a.p,c=a.treeReader,g=b[c.parent_id_field];if("nested"===a.treeGridModel){var e=null,h=c.left_field,d=c.right_field,k=c.level_field,m=parseInt(b[h],10),l=parseInt(b[d],10),n=parseInt(b[k],10);
f(a.data).each(function(){if(parseInt(this[k],10)===n-1&&parseInt(this[h],10)<m&&parseInt(this[d],10)>l)return e=this,!1});return e}if(null===g||"null"===g)return null;b=a._index[g];return void 0!==b?a.data[b]:null},getNodeChildren:function(b){var a=[];this.each(function(){var c=this.p;if(this.grid&&c.treeGrid)switch(c.treeGridModel){case "nested":var g=c.treeReader.left_field,e=c.treeReader.right_field,h=c.treeReader.level_field,d=parseInt(b[g],10),k=parseInt(b[e],10),m=parseInt(b[h],10);f(c.data).each(function(){parseInt(this[h],
10)===m+1&&parseInt(this[g],10)>d&&parseInt(this[e],10)<k&&a.push(this)});break;case "adjacency":var l=c.treeReader.parent_id_field,n=c.localReader.id;f(c.data).each(function(){String(this[l])===String(b[n])&&a.push(this)})}});return a},getFullTreeNode:function(b){var a=[];this.each(function(){var c=this.p,g;if(this.grid&&c.treeGrid)switch(c.treeGridModel){case "nested":var e=c.treeReader.left_field,h=c.treeReader.right_field,d=c.treeReader.level_field,k=parseInt(b[e],10),m=parseInt(b[h],10),l=parseInt(b[d],
10);f(c.data).each(function(){parseInt(this[d],10)>=l&&parseInt(this[e],10)>=k&&parseInt(this[e],10)<=m&&a.push(this)});break;case "adjacency":if(b){a.push(b);var n=c.treeReader.parent_id_field,w=c.localReader.id;f(c.data).each(function(){var b;g=a.length;for(b=0;b<g;b++)if(a[b][w]===this[n]){a.push(this);break}})}}});return a},getNodeAncestors:function(b){var a=[];this.each(function(){var c=f(this),g=l.getNodeParent;if(this.grid&&this.p.treeGrid)for(var e=g.call(c,b);e;)a.push(e),e=g.call(c,e)});
return a},isVisibleNode:function(b){var a=!0;this.each(function(){var c=this.p;if(this.grid&&c.treeGrid){var g=l.getNodeAncestors.call(f(this),b),e=c.treeReader.expanded_field;f(g).each(function(){a=a&&this[e];if(!a)return!1})}});return a},isNodeLoaded:function(b){var a;this.each(function(){var c=this.p;if(this.grid&&c.treeGrid){var g=c.treeReader.leaf_field,c=c.treeReader.loaded;a=void 0!==b?void 0!==b[c]?b[c]:b[g]||0<l.getNodeChildren.call(f(this),b).length?!0:!1:!1}});return a},expandNode:function(b){return this.each(function(){var a=
this.p;if(this.grid&&a.treeGrid){var c=a.treeReader.expanded_field,g=a.treeReader.parent_id_field,e=a.treeReader.loaded,h=a.treeReader.level_field,d=a.treeReader.left_field,k=a.treeReader.right_field;if(!b[c]){var m=y(b,a.localReader.id);if(u.call(this,"beforeExpandNode",{rowid:m,item:b})){var q=f("#"+a.idPrefix+A(m),this.grid.bDiv)[0],n=a._index[m];"local"===a.treedatatype||l.isNodeLoaded.call(f(this),a.data[n])?(b[c]=!0,f("div.treeclick",q).removeClass(a.treeIcons.plus+" tree-plus").addClass(a.treeIcons.commonIconClass).addClass(a.treeIcons.minus+
" tree-minus")):this.grid.hDiv.loading||(b[c]=!0,f("div.treeclick",q).removeClass(a.treeIcons.plus+" tree-plus").addClass(a.treeIcons.commonIconClass).addClass(a.treeIcons.minus+" tree-minus"),a.treeANode=q.rowIndex,a.datatype=a.treedatatype,l.setGridParam.call(f(this),{postData:"nested"===a.treeGridModel?{nodeid:m,n_level:b[h],n_left:b[d],n_right:b[k]}:{nodeid:m,n_level:b[h],parentid:b[g]}}),f(this).trigger("reloadGrid"),b[e]=!0,l.setGridParam.call(f(this),{postData:"nested"===a.treeGridModel?{nodeid:"",
n_level:"",n_left:"",n_right:""}:{nodeid:"",n_level:"",parentid:""}}));u.call(this,"afterExpandNode",{rowid:m,item:b})}}}})},collapseNode:function(b){return this.each(function(){var a=this.p;if(this.grid&&a.treeGrid){var c=a.treeReader.expanded_field;if(b[c]){var g=y(b,a.localReader.id);u.call(this,"beforeCollapseNode",{rowid:g,item:b})&&(b[c]=!1,c=f("#"+a.idPrefix+A(g),this.grid.bDiv)[0],f("div.treeclick",c).removeClass(a.treeIcons.minus+" tree-minus").addClass(a.treeIcons.commonIconClass).addClass(a.treeIcons.plus+
" tree-plus"),u.call(this,"afterCollapseNode",{rowid:g,item:b}))}}})},SortTree:function(b,a,c,g){return this.each(function(){var e=this,h=e.p,d=f(e);if(e.grid&&h.treeGrid){var k,m,q,n=[];k=l.getRootNodes.call(d);k=w.from.call(e,k);k.orderBy(b,a,c,g);var u=k.select();k=0;for(m=u.length;k<m;k++)q=u[k],n.push(q),l.collectChildrenSortTree.call(d,n,q,b,a,c,g);f.each(n,function(a){var b=y(this,h.localReader.id);f(e.rows[a]).after(d.find(">tbody>tr#"+A(b)))})}})},collectChildrenSortTree:function(b,a,c,g,
e,h){return this.each(function(){var d=f(this);if(this.grid&&this.p.treeGrid){var k,m,q;k=l.getNodeChildren.call(d,a);k=w.from.call(this,k);k.orderBy(c,g,e,h);var n=k.select();k=0;for(m=n.length;k<m;k++)q=n[k],b.push(q),l.collectChildrenSortTree.call(d,b,q,c,g,e,h)}})},setTreeRow:function(b,a){var c=!1;this.each(function(){this.grid&&this.p.treeGrid&&(c=l.setRowData.call(f(this),b,a))});return c},delTreeNode:function(b){return this.each(function(){var a=this.p,c,g,e,h;e=a.localReader.id;var d,k=f(this),
m=a.treeReader.left_field,q=a.treeReader.right_field;if(this.grid&&a.treeGrid&&(d=a._index[b],void 0!==d)){c=parseInt(a.data[d][q],10);g=c-parseInt(a.data[d][m],10)+1;var n=l.getFullTreeNode.call(k,a.data[d]);if(0<n.length)for(d=0;d<n.length;d++)l.delRowData.call(k,n[d][e]);if("nested"===a.treeGridModel){e=w.from.call(this,a.data).greater(m,c,{stype:"integer"}).select();if(e.length)for(h in e)e.hasOwnProperty(h)&&(e[h][m]=parseInt(e[h][m],10)-g);e=w.from.call(this,a.data).greater(q,c,{stype:"integer"}).select();
if(e.length)for(h in e)e.hasOwnProperty(h)&&(e[h][q]=parseInt(e[h][q],10)-g)}}})},addChildNode:function(b,a,c,g){var e=f(this),h=e[0],d=h.p,k=l.getInd;if(c){var m,q,n,u,v;m=0;var y=a,A,t,B=d.treeReader.expanded_field;t=d.treeReader.leaf_field;var p=d.treeReader.level_field,C=d.treeReader.parent_id_field,z=d.treeReader.left_field,x=d.treeReader.right_field,D=d.treeReader.loaded;void 0===g&&(g=!1);if(null==b){v=d.data.length-1;if(0<=v)for(;0<=v;)m=Math.max(m,parseInt(d.data[v][d.localReader.id],10)),
v--;b=m+1}var E=k.call(e,a);A=!1;void 0===a||null===a||""===a?(y=a=null,m="last",u=d.tree_root_level,v=d.data.length+1):(m="after",q=d._index[a],n=d.data[q],a=n[d.localReader.id],u=parseInt(n[p],10)+1,v=l.getFullTreeNode.call(e,n),v.length?(y=v=v[v.length-1][d.localReader.id],v=k.call(e,y)+1):v=k.call(e,a)+1,n[t]&&(A=!0,n[B]=!0,f(h.rows[E]).find("span.cell-wrapperleaf").removeClass("cell-wrapperleaf").addClass("cell-wrapper").end().find("div.tree-leaf").removeClass(d.treeIcons.leaf+" tree-leaf").addClass(d.treeIcons.commonIconClass).addClass(d.treeIcons.minus+
" tree-minus"),d.data[q][t]=!1,n[D]=!0));k=v+1;void 0===c[B]&&(c[B]=!1);void 0===c[D]&&(c[D]=!1);c[p]=u;void 0===c[t]&&(c[t]=!0);"adjacency"===d.treeGridModel&&(c[C]=a);if("nested"===d.treeGridModel){var r;if(null!==a){t=parseInt(n[x],10);d=w.from.call(h,d.data);d=d.greaterOrEquals(x,t,{stype:"integer"});p=d.select();if(p.length)for(r in p)p.hasOwnProperty(r)&&(p[r][z]=p[r][z]>t?parseInt(p[r][z],10)+2:p[r][z],p[r][x]=p[r][x]>=t?parseInt(p[r][x],10)+2:p[r][x]);c[z]=t;c[x]=t+1}else{t=parseInt(l.getCol.call(e,
x,!1,"max"),10);p=w.from.call(h,d.data).greater(z,t,{stype:"integer"}).select();if(p.length)for(r in p)p.hasOwnProperty(r)&&(p[r][z]=parseInt(p[r][z],10)+2);p=w.from.call(h,d.data).greater(x,t,{stype:"integer"}).select();if(p.length)for(r in p)p.hasOwnProperty(r)&&(p[r][x]=parseInt(p[r][x],10)+2);c[z]=t+1;c[x]=t+2}}if(null===a||l.isNodeLoaded.call(e,n)||A)l.addRowData.call(e,b,c,m,y),l.setTreeNode.call(e,v,k);n&&!n[B]&&g&&f(h.rows[E]).find("div.treeclick").click()}}})});
/*
//# sourceMappingURL=grid.treegrid.map
*/